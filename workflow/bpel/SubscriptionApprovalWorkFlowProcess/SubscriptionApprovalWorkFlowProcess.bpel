<!-- SubscriptionApprovalWorkFlowProcess BPEL Process [Generated by the Eclipse 
	BPEL Designer] -->
<!-- Date: Mon Mar 05 12:18:58 IST 2012 -->

<bpel:process name="SubscriptionApprovalWorkFlowProcess"
	targetNamespace="http://workflow.subscription.apimgt.carbon.wso2.org"
	suppressJoinFailure="yes"
	xmlns:tns="http://workflow.subscription.apimgt.carbon.wso2.org"
	xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
	xmlns:b4p="http://docs.oasis-open.org/ns/bpel4people/bpel4people/200803"
	xmlns:ns1="http://org.wso2.carbon/subscriptions/" xmlns:ns2="http://org.wso2.carbon/wso2telco/workflow"
	xmlns:ns3="http://org.wso2.carbon/wso2telco/workflow/subscription"
	xmlns:ns="http://callback.workflow.apimgt.carbon.wso2.org"
	queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath2.0"
	expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath2.0"
	xmlns:axau="http://org.wso2.carbon/wso2telco/workflow/audit"
	xmlns:axnotify="http://org.wso2.carbon/wso2telco/workflow/notify">

	<!-- Import the client WSDL -->
	<bpel:extensions>
		<bpel:extension
			namespace="http://docs.oasis-open.org/ns/bpel4people/bpel4people/200803"
			mustUnderstand="yes"></bpel:extension>
	</bpel:extensions>
	<bpel:import namespace="http://callback.workflow.apimgt.carbon.wso2.org"
		location="WorkflowCallbackService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
	<bpel:import namespace="http://org.wso2.carbon/subscriptions/"
		location="SubscriptionsApprovalTaskService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
	<bpel:import location="SubscriptionApprovalWorkFlowProcessArtifacts.wsdl"
		namespace="http://workflow.subscription.apimgt.carbon.wso2.org"
		importType="http://schemas.xmlsoap.org/wsdl/" />
	<bpel:import namespace="http://org.wso2.carbon/wso2telco/workflow"
		location="Wso2telcoWorkflowApprovalService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
	<!-- <bpel:import namespace="http://org.wso2.carbon/wso2telco/workflow/audit" 
		location="Wso2telcoWorkflowApprovalAuditService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import> -->
	<bpel:import namespace="http://org.wso2.carbon/wso2telco/workflow/notify"
		location="Wso2telcoWorkflowNotificationService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>

	<!-- ================================================================= -->
	<!-- PARTNERLINKS -->
	<!-- List of services participating in this BPEL process -->
	<!-- ================================================================= -->
	<bpel:partnerLinks>
		<!-- The 'client' role represents the requester of this service. It is 
			used for callback. The location and correlation information associated with 
			the client role are automatically set using WS-Addressing. -->
		<bpel:partnerLink name="client"
			partnerLinkType="tns:SubscriptionApprovalWorkFlowProcess" myRole="SubscriptionApprovalWorkFlowProcessProvider" />
		<bpel:partnerLink name="SAPL" partnerLinkType="tns:SAPLT"
			myRole="role2" partnerRole="role1"></bpel:partnerLink>
		<bpel:partnerLink name="CBPL" partnerLinkType="tns:CBPLT"
			partnerRole="role3"></bpel:partnerLink>
		<bpel:partnerLink name="AXSAPL" partnerLinkType="tns:AXSAPLT"
			partnerRole="wso2telcoDBHandlerRole" initializePartnerRole="yes"></bpel:partnerLink>
		<bpel:partnerLink name="AAUPL" partnerLinkType="tns:AAUPLT"
			partnerRole="wso2telcoAuditRole" initializePartnerRole="yes"></bpel:partnerLink>
		<bpel:partnerLink name="AXNOTIFYPL" partnerLinkType="tns:AXNOTIFYPLT"
			partnerRole="wso2telcoNotifyRole" initializePartnerRole="yes"></bpel:partnerLink>
	</bpel:partnerLinks>

	<!-- ================================================================= -->
	<!-- VARIABLES -->
	<!-- List of messages and XML documents used within this BPEL process -->
	<!-- ================================================================= -->
	<bpel:variables>
		<!-- Reference to the message passed as input during initiation -->
		<bpel:variable name="input" messageType="ns1:SubscriptionApprovalRequest" />

		<!-- Reference to the message that will be sent back to the requester during 
			callback -->
		<bpel:variable name="output" messageType="ns1:SubscriptionApprovalResponse" />
		<bpel:variable name="input_ht" messageType="ns1:SubscriptionApprovalRequest"></bpel:variable>
		<bpel:variable name="output_ht" messageType="ns1:SubscriptionApprovalResponse"></bpel:variable>
		<bpel:variable name="clientRequest"
			messageType="tns:SubscriptionApprovalWorkFlowProcessRequestMessage"></bpel:variable>
		<bpel:variable name="input_to_response" messageType="ns:resumeEventRequest"></bpel:variable>

		<!-- <bpel:variable name="input_op_ht" messageType="ns1:SubscriptionApprovalRequest"></bpel:variable> 
			<bpel:variable name="output_op_ht" messageType="ns1:SubscriptionApprovalResponse"></bpel:variable> -->
		<bpel:variable name="input_hub_approval_db" messageType="ns2:SubHUBApprovalDBUpdateRequest"></bpel:variable>
		<bpel:variable name="input_op_approval_db" messageType="ns2:SubOpApprovalDBUpdateRequest"></bpel:variable>

		<bpel:variable name="input_sub_op_list" messageType="ns2:SubOperatorRetrievalRequest"></bpel:variable>
		<bpel:variable name="output_sub_op_list" messageType="ns2:SubOperatorRetrievalResponse"></bpel:variable>

		<bpel:variable name="input_op_ht_dialog" messageType="ns1:SubscriptionApprovalRequest"></bpel:variable>
		<bpel:variable name="input_op_ht_celcom" messageType="ns1:SubscriptionApprovalRequest"></bpel:variable>
		<bpel:variable name="output_op_ht_dialog" messageType="ns1:SubscriptionApprovalResponse"></bpel:variable>
		<bpel:variable name="output_op_ht_celcom" messageType="ns1:SubscriptionApprovalResponse"></bpel:variable>

		<bpel:variable name="input_hub_sub_approval_audit"
			messageType="ns2:SubApprovalAuditRequest"></bpel:variable>
		<bpel:variable name="input_op_sub_approval_audit_dialog"
			messageType="ns2:SubApprovalAuditRequest"></bpel:variable>
		<bpel:variable name="input_op_sub_approval_audit_celcom"
			messageType="ns2:SubApprovalAuditRequest"></bpel:variable>

		<bpel:variable name="input_hub_approval_sub_validator"
			messageType="ns2:HUBApprovalSubValidatorRequest"></bpel:variable>

		<bpel:variable name="input_hub_approver_email_notification"
			messageType="axnotify:HUBAdminSubApprovalEmailNotificationRequest" />
		<bpel:variable name="input_op_approver_dialog_email_notification"
			messageType="axnotify:HUBAdminSubApprovalEmailNotificationRequest" />
		<bpel:variable name="input_op_approver_celcom_email_notification"
			messageType="axnotify:HUBAdminSubApprovalEmailNotificationRequest" />
		<bpel:variable name="input_approval_status_sp_email_notification"
			messageType="axnotify:SubApprovalStatusSPEmailNotificationRequest" />

	</bpel:variables>

	<!-- ================================================================= -->
	<!-- ORCHESTRATION LOGIC -->
	<!-- Set of activities coordinating the flow of messages across the -->
	<!-- services integrated within this business process -->
	<!-- ================================================================= -->
	<bpel:sequence name="main">

		<!-- Receive input from requestor. Note: This maps to operation defined 
			in SubscriptionApprovalWorkFlowProcess.wsdl -->
		<bpel:receive name="receiveInput" partnerLink="client"
			createInstance="yes" operation="initiate"
			portType="tns:SubscriptionApprovalWorkFlowProcess" variable="clientRequest" />

		<bpel:if name="if_email_notifications_enabled">
			<bpel:condition>
            		<![CDATA[false()]]>
			</bpel:condition>

			<bpel:sequence>
				<bpel:assign validate="no"
					name="assign_hub_approver_email_notification">
					<bpel:copy>
						<bpel:from>
							<bpel:literal>
								<axnotify:HUBAdminSubApprovalEmailNotificationRequest
									xmlns:axnotify="http://org.wso2.carbon/wso2telco/workflow/notify"
									xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
									<axnotify:receiverRole>axnotify:receiverRole
									</axnotify:receiverRole>
									<axnotify:apiName>axnotify:apiName</axnotify:apiName>
									<axnotify:apiVersion>axnotify:apiVersion</axnotify:apiVersion>
									<axnotify:apiContext>axnotify:apiContext</axnotify:apiContext>
									<axnotify:apiProvider>axnotify:apiProvider
									</axnotify:apiProvider>
									<axnotify:subscriber>axnotify:subscriber</axnotify:subscriber>
									<axnotify:subscriptionTier>axnotify:subscriptionTier
									</axnotify:subscriptionTier>
									<axnotify:applicationName>axnotify:applicationName
									</axnotify:applicationName>
									<axnotify:applicationDescription>axnotify:applicationDescription
									</axnotify:applicationDescription>
								</axnotify:HUBAdminSubApprovalEmailNotificationRequest>
							</bpel:literal>
						</bpel:from>
						<bpel:to variable="input_hub_approver_email_notification"
							part="HUBAdminSubApprovalEmailNotificationRequest"></bpel:to>
					</bpel:copy>
					<bpel:copy>
						<bpel:from>
                	<![CDATA['admin']]>
						</bpel:from>
						<bpel:to part="HUBAdminSubApprovalEmailNotificationRequest"
							variable="input_hub_approver_email_notification">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:receiverRole]]></bpel:query>
						</bpel:to>
					</bpel:copy>
					<bpel:copy>
						<bpel:from part="payload" variable="clientRequest">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiName]]></bpel:query>
						</bpel:from>
						<bpel:to part="HUBAdminSubApprovalEmailNotificationRequest"
							variable="input_hub_approver_email_notification">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:apiName]]></bpel:query>
						</bpel:to>
					</bpel:copy>
					<bpel:copy>
						<bpel:from part="payload" variable="clientRequest">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiVersion]]></bpel:query>
						</bpel:from>
						<bpel:to part="HUBAdminSubApprovalEmailNotificationRequest"
							variable="input_hub_approver_email_notification">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:apiVersion]]></bpel:query>
						</bpel:to>
					</bpel:copy>
					<bpel:copy>
						<bpel:from part="payload" variable="clientRequest">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiContext]]></bpel:query>
						</bpel:from>
						<bpel:to part="HUBAdminSubApprovalEmailNotificationRequest"
							variable="input_hub_approver_email_notification">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:apiContext]]></bpel:query>
						</bpel:to>
					</bpel:copy>
					<bpel:copy>
						<bpel:from part="payload" variable="clientRequest">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiProvider]]></bpel:query>
						</bpel:from>
						<bpel:to part="HUBAdminSubApprovalEmailNotificationRequest"
							variable="input_hub_approver_email_notification">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:apiProvider]]></bpel:query>
						</bpel:to>
					</bpel:copy>
					<bpel:copy>
						<bpel:from part="payload" variable="clientRequest">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:subscriber]]></bpel:query>
						</bpel:from>
						<bpel:to part="HUBAdminSubApprovalEmailNotificationRequest"
							variable="input_hub_approver_email_notification">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:subscriber]]></bpel:query>
						</bpel:to>
					</bpel:copy>
					<bpel:copy>
						<bpel:from part="payload" variable="clientRequest">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:tierName]]></bpel:query>
						</bpel:from>
						<bpel:to part="HUBAdminSubApprovalEmailNotificationRequest"
							variable="input_hub_approver_email_notification">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:subscriptionTier]]></bpel:query>
						</bpel:to>
					</bpel:copy>
					<bpel:copy>
						<bpel:from part="payload" variable="clientRequest">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationName]]></bpel:query>
						</bpel:from>
						<bpel:to part="HUBAdminSubApprovalEmailNotificationRequest"
							variable="input_hub_approver_email_notification">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:applicationName]]></bpel:query>
						</bpel:to>
					</bpel:copy>
					<bpel:copy>
						<bpel:from part="payload" variable="clientRequest">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationDescription]]></bpel:query>
						</bpel:from>
						<bpel:to part="HUBAdminSubApprovalEmailNotificationRequest"
							variable="input_hub_approver_email_notification">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:applicationDescription]]></bpel:query>
						</bpel:to>
					</bpel:copy>
				</bpel:assign>
				<bpel:invoke name="invoke_hub_approver_email_notification"
					partnerLink="AXNOTIFYPL" operation="sendHUBAdminSubApprovalEmailNotification"
					portType="axnotify:Wso2telcoWorkflowNotificationServicePT"
					inputVariable="input_hub_approver_email_notification">
				</bpel:invoke>
			</bpel:sequence>
		</bpel:if>

		<!-- Initialize the HUB approval request and set input parameter values. -->
		<bpel:assign validate="no" name="assign_hub_input">
			<bpel:copy>
				<bpel:from>
					<bpel:literal>
						<tschema:SubscriptionApprovalData
							xmlns:tschema="http://workflow.subscription.apimgt.carbon.wso2.org"
							xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
							<tschema:apiName>tschema:apiName</tschema:apiName>
							<tschema:apiVersion>tschema:apiVersion</tschema:apiVersion>
							<tschema:apiContext>tschema:apiContext</tschema:apiContext>
							<tschema:apiProvider>tschema:apiProvider</tschema:apiProvider>
							<tschema:subscriber>tschema:subscriber</tschema:subscriber>
							<tschema:applicationName>tschema:applicationName
							</tschema:applicationName>
							<tschema:tierName>tschema:tierName</tschema:tierName>
							<tschema:callBackURL>tschema:callBackURL</tschema:callBackURL>
							<tschema:workflowExternalRef>tschema:workflowExternalRef
							</tschema:workflowExternalRef>
							<tschema:operatorID>tschema:operatorID</tschema:operatorID>
							<tschema:authorizedRole>tschema:authorizedRole
							</tschema:authorizedRole>
							<tschema:applicationDescription>tschema:applicationDescription
							</tschema:applicationDescription>
							<tschema:tiers>tschema:tiers</tschema:tiers>
							<tschema:applicationId>tschema:applicationId
							</tschema:applicationId>
							<tschema:apiID>tschema:apiID</tschema:apiID>
						</tschema:SubscriptionApprovalData>
					</bpel:literal>
				</bpel:from>
				<bpel:to part="SubscriptionApprovalRequest" variable="input_ht"></bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiName]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubscriptionApprovalRequest" variable="input_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiName]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiVersion]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubscriptionApprovalRequest" variable="input_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiVersion]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiContext]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubscriptionApprovalRequest" variable="input_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiContext]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiProvider]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubscriptionApprovalRequest" variable="input_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiProvider]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:subscriber]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubscriptionApprovalRequest" variable="input_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:subscriber]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationName]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubscriptionApprovalRequest" variable="input_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationName]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:tierName]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubscriptionApprovalRequest" variable="input_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:tierName]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:callBackURL]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubscriptionApprovalRequest" variable="input_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:callBackURL]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:workflowExternalRef]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubscriptionApprovalRequest" variable="input_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:workflowExternalRef]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<!-- Set the default operator id for HUB admin user. This is just a dummy 
				value passed in the request, and not used for any processing. -->
			<bpel:copy>
				<bpel:from>
                	<![CDATA['0']]>
				</bpel:from>
				<bpel:to part="SubscriptionApprovalRequest" variable="input_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:operatorID]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<!-- Set the role 'admin' for HUB level workflow administrator. -->
			<bpel:copy>
				<bpel:from>
                	<![CDATA['admin']]>
				</bpel:from>
				<bpel:to part="SubscriptionApprovalRequest" variable="input_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:authorizedRole]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<!-- Set the application description. -->
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationDescription]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubscriptionApprovalRequest" variable="input_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationDescription]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<!-- Set the list of available tiers for subscription creation. -->
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:tiers]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubscriptionApprovalRequest" variable="input_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:tiers]]></bpel:query>
				</bpel:to>
			</bpel:copy>

			<!-- Set the application Id. -->
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationId]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubscriptionApprovalRequest" variable="input_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationId]]></bpel:query>
				</bpel:to>
			</bpel:copy>

			<!-- Set the API Id. -->
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiID]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubscriptionApprovalRequest" variable="input_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiID]]></bpel:query>
				</bpel:to>
			</bpel:copy>
		</bpel:assign>

		<!-- Asynchronous callback to the requester. Note: the callback location 
			and correlation id is transparently handled using WS-addressing. -->
		<bpel:extensionActivity>
			<b4p:peopleActivity name="subscription_approve_hub"
				inputVariable="input_ht" outputVariable="output_ht">
				<b4p:remoteTask partnerLink="SAPL" operation="approve"
					responseOperation="approvalResponse"></b4p:remoteTask>
			</b4p:peopleActivity>
		</bpel:extensionActivity>

		<!-- Obtain the HUB apporval response values. -->
		<bpel:assign validate="no" name="assign_hub_output">
			<bpel:copy>
				<bpel:from>
					<bpel:literal xml:space="preserve">
						<resumeEvent xmlns:ns="http://callback.workflow.apimgt.carbon.wso2.org"
						xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
         					<ns:workflowReference>ns:workflowReference</ns:workflowReference>
         					<ns:status>ns:status</ns:status>
         					<ns:description>ns:description</ns:description>
						</resumeEvent>
					</bpel:literal>
				</bpel:from>
				<bpel:to part="parameters" variable="input_to_response"></bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="SubscriptionApprovalResponse" variable="output_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:status]]></bpel:query>
				</bpel:from>
				<bpel:to part="parameters" variable="input_to_response">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:status]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="SubscriptionApprovalResponse" variable="output_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:workflowExternalRef]]></bpel:query>
				</bpel:from>
				<bpel:to part="parameters" variable="input_to_response">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:workflowReference]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="SubscriptionApprovalResponse" variable="output_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:description]]></bpel:query>
				</bpel:from>
				<bpel:to part="parameters" variable="input_to_response">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:description]]></bpel:query>
				</bpel:to>
			</bpel:copy>
		</bpel:assign>

		<!-- Invoke HUB callback request with the HUB approval status details. -->
		<bpel:invoke name="invoke_hub_callback" partnerLink="CBPL"
			operation="resumeEvent" portType="ns:WorkflowCallbackServicePortType"
			inputVariable="input_to_response">
		</bpel:invoke>

		<!-- [START] Trigger email notification to the SP with the Sub approval 
			status. -->

		<bpel:if name="if_email_notifications_enabled">
			<bpel:condition>
               						 <![CDATA[false()]]>
			</bpel:condition>
			<bpel:sequence>
				<bpel:assign validate="no"
					name="assign_approval_status_sp_email_notification">
					<bpel:copy>
						<bpel:from>
							<bpel:literal>
								<axnotify:SubApprovalStatusSPEmailNotificationRequest
									xmlns:axnotify="http://org.wso2.carbon/wso2telco/workflow/notify"
									xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
									<axnotify:apiName>axnotify:apiName</axnotify:apiName>
									<axnotify:apiVersion>axnotify:apiVersion</axnotify:apiVersion>
									<axnotify:apiContext>axnotify:apiContext</axnotify:apiContext>
									<axnotify:apiProvider>axnotify:apiProvider
									</axnotify:apiProvider>
									<axnotify:subscriber>axnotify:subscriber</axnotify:subscriber>
									<axnotify:subscriptionTier>axnotify:subscriptionTier
									</axnotify:subscriptionTier>
									<axnotify:applicationName>axnotify:applicationName
									</axnotify:applicationName>
									<axnotify:applicationDescription>axnotify:applicationDescription
									</axnotify:applicationDescription>
									<axnotify:approvalStatus>axnotify:approvalStatus
									</axnotify:approvalStatus>
								</axnotify:SubApprovalStatusSPEmailNotificationRequest>
							</bpel:literal>
						</bpel:from>
						<bpel:to variable="input_approval_status_sp_email_notification"
							part="SubApprovalStatusSPEmailNotificationRequest"></bpel:to>
					</bpel:copy>
					<bpel:copy>
						<bpel:from part="payload" variable="clientRequest">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiName]]></bpel:query>
						</bpel:from>
						<bpel:to part="SubApprovalStatusSPEmailNotificationRequest"
							variable="input_approval_status_sp_email_notification">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:apiName]]></bpel:query>
						</bpel:to>
					</bpel:copy>
					<bpel:copy>
						<bpel:from part="payload" variable="clientRequest">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiVersion]]></bpel:query>
						</bpel:from>
						<bpel:to part="SubApprovalStatusSPEmailNotificationRequest"
							variable="input_approval_status_sp_email_notification">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:apiVersion]]></bpel:query>
						</bpel:to>
					</bpel:copy>
					<bpel:copy>
						<bpel:from part="payload" variable="clientRequest">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiContext]]></bpel:query>
						</bpel:from>
						<bpel:to part="SubApprovalStatusSPEmailNotificationRequest"
							variable="input_approval_status_sp_email_notification">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:apiContext]]></bpel:query>
						</bpel:to>
					</bpel:copy>
					<bpel:copy>
						<bpel:from part="payload" variable="clientRequest">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiProvider]]></bpel:query>
						</bpel:from>
						<bpel:to part="SubApprovalStatusSPEmailNotificationRequest"
							variable="input_approval_status_sp_email_notification">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:apiProvider]]></bpel:query>
						</bpel:to>
					</bpel:copy>
					<bpel:copy>
						<bpel:from part="payload" variable="clientRequest">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:subscriber]]></bpel:query>
						</bpel:from>
						<bpel:to part="SubApprovalStatusSPEmailNotificationRequest"
							variable="input_approval_status_sp_email_notification">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:subscriber]]></bpel:query>
						</bpel:to>
					</bpel:copy>
					<bpel:copy>
						<bpel:from part="SubscriptionApprovalResponse" variable="output_ht">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:selectedTier]]></bpel:query>
						</bpel:from>
						<bpel:to part="SubApprovalStatusSPEmailNotificationRequest"
							variable="input_approval_status_sp_email_notification">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:subscriptionTier]]></bpel:query>
						</bpel:to>
					</bpel:copy>
					<bpel:copy>
						<bpel:from part="payload" variable="clientRequest">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationName]]></bpel:query>
						</bpel:from>
						<bpel:to part="SubApprovalStatusSPEmailNotificationRequest"
							variable="input_approval_status_sp_email_notification">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:applicationName]]></bpel:query>
						</bpel:to>
					</bpel:copy>
					<bpel:copy>
						<bpel:from part="payload" variable="clientRequest">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationDescription]]></bpel:query>
						</bpel:from>
						<bpel:to part="SubApprovalStatusSPEmailNotificationRequest"
							variable="input_approval_status_sp_email_notification">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:applicationDescription]]></bpel:query>
						</bpel:to>
					</bpel:copy>
					<bpel:copy>
						<bpel:from part="SubscriptionApprovalResponse" variable="output_ht">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:status]]></bpel:query>
						</bpel:from>
						<bpel:to part="SubApprovalStatusSPEmailNotificationRequest"
							variable="input_approval_status_sp_email_notification">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:approvalStatus]]></bpel:query>
						</bpel:to>
					</bpel:copy>
				</bpel:assign>
				<bpel:invoke name="invoke_approval_status_sp_email_notification"
					partnerLink="AXNOTIFYPL" operation="sendSubApprovalStatusSPEmailNotification"
					portType="axnotify:Wso2telcoWorkflowNotificationServicePT"
					inputVariable="input_approval_status_sp_email_notification">
				</bpel:invoke>
			</bpel:sequence>
		</bpel:if>

		<!-- [END] Sub approval status SP email notification. -->

		<bpel:assign validate="no" name="assign_hub_au_intput">
			<bpel:copy>
				<bpel:from>
					<bpel:literal>
						<axau:SubApprovalAuditRequest
							xmlns:axau="http://org.wso2.carbon/wso2telco/workflow/audit"
							xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
							<axau:requestType>axau:requestType</axau:requestType>
							<axau:apiProvider>axau:apiProvider</axau:apiProvider>
							<axau:apiName>axau:apiName</axau:apiName>
							<axau:apiVersion>axau:apiVersion</axau:apiVersion>
							<axau:appId>axau:appId</axau:appId>
							<axau:subStatus>axau:subStatus</axau:subStatus>
							<axau:subApprovalType>axau:subApprovalType</axau:subApprovalType>
							<axau:completedByRole>axau:completedByRole</axau:completedByRole>
							<axau:completedByUser>axau:completedByUser</axau:completedByUser>
							<axau:completedOn>axau:completedOn</axau:completedOn>
						</axau:SubApprovalAuditRequest>
					</bpel:literal>
				</bpel:from>
				<bpel:to variable="input_hub_sub_approval_audit" part="SubApprovalAuditRequest"></bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from>
					<![CDATA['SUB_APPROVAL_AUDIT_REQUEST']]>
				</bpel:from>
				<bpel:to part="SubApprovalAuditRequest" variable="input_hub_sub_approval_audit">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:requestType]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiProvider]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubApprovalAuditRequest" variable="input_hub_sub_approval_audit">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:apiProvider]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiName]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubApprovalAuditRequest" variable="input_hub_sub_approval_audit">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:apiName]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiVersion]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubApprovalAuditRequest" variable="input_hub_sub_approval_audit">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:apiVersion]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationId]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubApprovalAuditRequest" variable="input_hub_sub_approval_audit">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:appId]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="SubscriptionApprovalResponse" variable="output_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:status]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubApprovalAuditRequest" variable="input_hub_sub_approval_audit">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:subStatus]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from>
					<![CDATA['HUB_ADMIN']]>
				</bpel:from>
				<bpel:to part="SubApprovalAuditRequest" variable="input_hub_sub_approval_audit">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:subApprovalType]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from>
					<![CDATA['admin']]>
				</bpel:from>
				<bpel:to part="SubApprovalAuditRequest" variable="input_hub_sub_approval_audit">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:completedByRole]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="SubscriptionApprovalResponse" variable="output_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:completedByUser]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubApprovalAuditRequest" variable="input_hub_sub_approval_audit">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:completedByUser]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="SubscriptionApprovalResponse" variable="output_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:completedOn]]></bpel:query>
				</bpel:from>
				<bpel:to part="SubApprovalAuditRequest" variable="input_hub_sub_approval_audit">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:completedOn]]></bpel:query>
				</bpel:to>
			</bpel:copy>
		</bpel:assign>
		<bpel:invoke name="invoke_hub_sub_approval_audit_insert"
			partnerLink="AAUPL" operation="insertSubApprovalAuditRecord"
			portType="ns2:Wso2telcoWorkflowApprovalServicePT" inputVariable="input_hub_sub_approval_audit">
		</bpel:invoke>

		<!-- Execute sequence containing operator approval workflow logic. -->
		<bpel:sequence name="op_approval_sequence">

			<!-- If HUB admin has approved the request. -->
			<bpel:if name="if_hub_admin_approved">
				<bpel:condition><![CDATA[contains($output_ht.SubscriptionApprovalResponse, "APPROVED")]]></bpel:condition>
				<bpel:sequence name="Sequence">

					<!-- Initialize the HUB approval database update request and set input 
						parameter values. -->
					<bpel:assign validate="no" name="assign_hub_db_input">
						<bpel:copy>
							<bpel:from>
								<bpel:literal xml:space="preserve">
                                	<ax:SubHUBApprovalDBUpdateRequest
									xmlns:ax="http://org.wso2.carbon/wso2telco/workflow/subscription"
									xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                                    	<ax:requestType>ax:requestType</ax:requestType>
  										<ax:appID>ax:appID</ax:appID>
  										<ax:apiName>ax:apiName</ax:apiName>
                                    </ax:SubHUBApprovalDBUpdateRequest>
                                </bpel:literal>
							</bpel:from>
							<bpel:to part="SubHUBApprovalDBUpdateRequest" variable="input_hub_approval_db"></bpel:to>
						</bpel:copy>
						<bpel:copy>
							<bpel:from>
                                <![CDATA['SUB_HUB_APPROVAL']]>
							</bpel:from>
							<bpel:to part="SubHUBApprovalDBUpdateRequest" variable="input_hub_approval_db">
								<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:requestType]]></bpel:query>
							</bpel:to>
						</bpel:copy>
						<bpel:copy>
							<bpel:from part="payload" variable="clientRequest">
								<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationId]]></bpel:query>
							</bpel:from>
							<bpel:to part="SubHUBApprovalDBUpdateRequest" variable="input_hub_approval_db">
								<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:appID]]></bpel:query>
							</bpel:to>
						</bpel:copy>
						<bpel:copy>
							<bpel:from part="payload" variable="clientRequest">
								<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiName]]></bpel:query>
							</bpel:from>
							<bpel:to part="SubHUBApprovalDBUpdateRequest" variable="input_hub_approval_db">
								<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:apiName]]></bpel:query>
							</bpel:to>
						</bpel:copy>
					</bpel:assign>

					<!-- Invoke the service call to perform HUB approval DB updates. -->
					<bpel:invoke name="invoke_hub_approval_db_update"
						partnerLink="AXSAPL" operation="updateDBSubHubApproval"
						portType="ns2:Wso2telcoWorkflowApprovalServicePT" inputVariable="input_hub_approval_db">
					</bpel:invoke>

					<!-- Initialize the HUB approval subscription validator request update 
						and set input parameter values. -->
					<bpel:assign validate="no"
						name="assign_hub_approval_sub_validator">
						<bpel:copy>
							<bpel:from>
								<bpel:literal xml:space="preserve">
                                	<ax:HUBApprovalSubValidatorRequest
									xmlns:ax="http://org.wso2.carbon/wso2telco/workflow/subscription"
									xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                                    	<ax:requestType>ax:requestType</ax:requestType>
  										<ax:appID>ax:appID</ax:appID>
  										<ax:apiID>ax:apiID</ax:apiID>
                                    </ax:HUBApprovalSubValidatorRequest>
                                </bpel:literal>
							</bpel:from>
							<bpel:to part="HUBApprovalSubValidatorRequest" variable="input_hub_approval_sub_validator"></bpel:to>
						</bpel:copy>
						<bpel:copy>
							<bpel:from>
                                <![CDATA['SUB_HUB_VALIDATOR']]>
							</bpel:from>
							<bpel:to part="HUBApprovalSubValidatorRequest" variable="input_hub_approval_sub_validator">
								<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:requestType]]></bpel:query>
							</bpel:to>
						</bpel:copy>
						<bpel:copy>
							<bpel:from part="payload" variable="clientRequest">
								<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationId]]></bpel:query>
							</bpel:from>
							<bpel:to part="HUBApprovalSubValidatorRequest" variable="input_hub_approval_sub_validator">
								<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:appID]]></bpel:query>
							</bpel:to>
						</bpel:copy>
						<bpel:copy>
							<bpel:from part="payload" variable="clientRequest">
								<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiID]]></bpel:query>
							</bpel:from>
							<bpel:to part="HUBApprovalSubValidatorRequest" variable="input_hub_approval_sub_validator">
								<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:apiID]]></bpel:query>
							</bpel:to>
						</bpel:copy>
					</bpel:assign>

					<!-- Invoke the service call to perform HUB approval subscription validator 
						updates. -->
					<bpel:invoke name="invoke_hub_approval_sub_validator_update"
						partnerLink="AXSAPL" operation="insertValidatorForSubscription"
						portType="ns2:Wso2telcoWorkflowApprovalServicePT" inputVariable="input_hub_approval_sub_validator">
					</bpel:invoke>


					<!-- Initialize the subscription operator list retrieval request and 
						set input parameter values. -->
					<bpel:assign validate="no" name="assign_sub_op_input">
						<bpel:copy>
							<bpel:from>
								<bpel:literal xml:space="preserve">
                                	<ax:SubOperatorRetrievalRequest
									xmlns:ax="http://org.wso2.carbon/wso2telco/workflow/subscription"
									xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                                    	<ax:requestType>ax:requestType</ax:requestType>
  										<ax:apiName>ax:apiName</ax:apiName>
  										<ax:apiVersion>ax:apiVersion</ax:apiVersion>
  										<ax:apiProvider>ax:apiProvider</ax:apiProvider>
  										<ax:appId>ax:appId</ax:appId>
                                    </ax:SubOperatorRetrievalRequest>
                                </bpel:literal>
							</bpel:from>
							<bpel:to part="SubOperatorRetrievalRequest" variable="input_sub_op_list"></bpel:to>
						</bpel:copy>
						<bpel:copy>
							<bpel:from>
                                <![CDATA['SUB_OP_LIST']]>
							</bpel:from>
							<bpel:to part="SubOperatorRetrievalRequest" variable="input_sub_op_list">
								<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:requestType]]></bpel:query>
							</bpel:to>
						</bpel:copy>
						<bpel:copy>
							<bpel:from part="payload" variable="clientRequest">
								<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiName]]></bpel:query>
							</bpel:from>
							<bpel:to part="SubOperatorRetrievalRequest" variable="input_sub_op_list">
								<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:apiName]]></bpel:query>
							</bpel:to>
						</bpel:copy>
						<bpel:copy>
							<bpel:from part="payload" variable="clientRequest">
								<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiVersion]]></bpel:query>
							</bpel:from>
							<bpel:to part="SubOperatorRetrievalRequest" variable="input_sub_op_list">
								<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:apiVersion]]></bpel:query>
							</bpel:to>
						</bpel:copy>
						<bpel:copy>
							<bpel:from part="payload" variable="clientRequest">
								<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiProvider]]></bpel:query>
							</bpel:from>
							<bpel:to part="SubOperatorRetrievalRequest" variable="input_sub_op_list">
								<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:apiProvider]]></bpel:query>
							</bpel:to>
						</bpel:copy>
						<bpel:copy>
							<bpel:from part="payload" variable="clientRequest">
								<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationId]]></bpel:query>
							</bpel:from>
							<bpel:to part="SubOperatorRetrievalRequest" variable="input_sub_op_list">
								<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:appId]]></bpel:query>
							</bpel:to>
						</bpel:copy>
					</bpel:assign>

					<!-- Invoke the service call to retrieve subscription operator list. -->
					<bpel:invoke name="invoke_sub_operator_list_retrieval"
						partnerLink="AXSAPL" operation="retrieveSubOperatorList"
						portType="ns2:Wso2telcoWorkflowApprovalServicePT" inputVariable="input_sub_op_list"
						outputVariable="output_sub_op_list">
					</bpel:invoke>



					<!-- For each operator, perform the following flow activities. -->
					<bpel:flow name="op_approval_flow">


						<!-- If operator 'DIALOG' is selected for subscription approval. -->
						<bpel:if name="if_dialog_op_selected">
							<bpel:condition>
                						<![CDATA[contains($output_sub_op_list.SubOperatorRetrievalResponse, 'DIALOG')]]>
							</bpel:condition>

							<!-- Subscription operator approval sequence: Dialog. -->
							<bpel:sequence name="dialog_op_approval_sequence">

								<bpel:if name="if_email_notifications_enabled">
									<bpel:condition>
               						 <![CDATA[false()]]>
									</bpel:condition>
									<bpel:sequence>
										<bpel:assign validate="no"
											name="assign_op_approver_dialog_email_notification">
											<bpel:copy>
												<bpel:from>
													<bpel:literal>
														<axnotify:HUBAdminSubApprovalEmailNotificationRequest
															xmlns:axnotify="http://org.wso2.carbon/wso2telco/workflow/notify"
															xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
															<axnotify:receiverRole>axnotify:receiverRole
															</axnotify:receiverRole>
															<axnotify:apiName>axnotify:apiName</axnotify:apiName>
															<axnotify:apiVersion>axnotify:apiVersion
															</axnotify:apiVersion>
															<axnotify:apiContext>axnotify:apiContext
															</axnotify:apiContext>
															<axnotify:apiProvider>axnotify:apiProvider
															</axnotify:apiProvider>
															<axnotify:subscriber>axnotify:subscriber
															</axnotify:subscriber>
															<axnotify:subscriptionTier>axnotify:subscriptionTier
															</axnotify:subscriptionTier>
															<axnotify:applicationName>axnotify:applicationName
															</axnotify:applicationName>
															<axnotify:applicationDescription>axnotify:applicationDescription
															</axnotify:applicationDescription>
														</axnotify:HUBAdminSubApprovalEmailNotificationRequest>
													</bpel:literal>
												</bpel:from>
												<bpel:to variable="input_op_approver_dialog_email_notification"
													part="HUBAdminSubApprovalEmailNotificationRequest"></bpel:to>
											</bpel:copy>
											<bpel:copy>
												<bpel:from>
                							<![CDATA['dialog-admin-role']]>
												</bpel:from>
												<bpel:to part="HUBAdminSubApprovalEmailNotificationRequest"
													variable="input_op_approver_dialog_email_notification">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:receiverRole]]></bpel:query>
												</bpel:to>
											</bpel:copy>
											<bpel:copy>
												<bpel:from part="payload" variable="clientRequest">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiName]]></bpel:query>
												</bpel:from>
												<bpel:to part="HUBAdminSubApprovalEmailNotificationRequest"
													variable="input_op_approver_dialog_email_notification">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:apiName]]></bpel:query>
												</bpel:to>
											</bpel:copy>
											<bpel:copy>
												<bpel:from part="payload" variable="clientRequest">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiVersion]]></bpel:query>
												</bpel:from>
												<bpel:to part="HUBAdminSubApprovalEmailNotificationRequest"
													variable="input_op_approver_dialog_email_notification">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:apiVersion]]></bpel:query>
												</bpel:to>
											</bpel:copy>
											<bpel:copy>
												<bpel:from part="payload" variable="clientRequest">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiContext]]></bpel:query>
												</bpel:from>
												<bpel:to part="HUBAdminSubApprovalEmailNotificationRequest"
													variable="input_op_approver_dialog_email_notification">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:apiContext]]></bpel:query>
												</bpel:to>
											</bpel:copy>
											<bpel:copy>
												<bpel:from part="payload" variable="clientRequest">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiProvider]]></bpel:query>
												</bpel:from>
												<bpel:to part="HUBAdminSubApprovalEmailNotificationRequest"
													variable="input_op_approver_dialog_email_notification">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:apiProvider]]></bpel:query>
												</bpel:to>
											</bpel:copy>
											<bpel:copy>
												<bpel:from part="payload" variable="clientRequest">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:subscriber]]></bpel:query>
												</bpel:from>
												<bpel:to part="HUBAdminSubApprovalEmailNotificationRequest"
													variable="input_op_approver_dialog_email_notification">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:subscriber]]></bpel:query>
												</bpel:to>
											</bpel:copy>
											<bpel:copy>
												<bpel:from part="SubscriptionApprovalResponse"
													variable="output_ht">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:selectedTier]]></bpel:query>
												</bpel:from>
												<bpel:to part="HUBAdminSubApprovalEmailNotificationRequest"
													variable="input_op_approver_dialog_email_notification">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:subscriptionTier]]></bpel:query>
												</bpel:to>
											</bpel:copy>
											<bpel:copy>
												<bpel:from part="payload" variable="clientRequest">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationName]]></bpel:query>
												</bpel:from>
												<bpel:to part="HUBAdminSubApprovalEmailNotificationRequest"
													variable="input_op_approver_dialog_email_notification">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:applicationName]]></bpel:query>
												</bpel:to>
											</bpel:copy>
											<bpel:copy>
												<bpel:from part="payload" variable="clientRequest">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationDescription]]></bpel:query>
												</bpel:from>
												<bpel:to part="HUBAdminSubApprovalEmailNotificationRequest"
													variable="input_op_approver_dialog_email_notification">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:applicationDescription]]></bpel:query>
												</bpel:to>
											</bpel:copy>
										</bpel:assign>
										<bpel:invoke name="invoke_op_approver_dialog_email_notification"
											partnerLink="AXNOTIFYPL" operation="sendHUBAdminSubApprovalEmailNotification"
											portType="axnotify:Wso2telcoWorkflowNotificationServicePT"
											inputVariable="input_op_approver_dialog_email_notification">
										</bpel:invoke>
									</bpel:sequence>
								</bpel:if>

								<!-- Initialize the operator approval humantask request and set input 
									parameters. -->

								<bpel:assign validate="no" name="assign_op_input">
									<bpel:copy>
										<bpel:from>
											<bpel:literal>
												<tschema:SubscriptionApprovalData
													xmlns:tschema="http://workflow.subscription.apimgt.carbon.wso2.org"
													xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
													<tschema:apiName>tschema:apiName</tschema:apiName>
													<tschema:apiVersion>tschema:apiVersion</tschema:apiVersion>
													<tschema:apiContext>tschema:apiContext</tschema:apiContext>
													<tschema:apiProvider>tschema:apiProvider
													</tschema:apiProvider>
													<tschema:subscriber>tschema:subscriber</tschema:subscriber>
													<tschema:applicationName>tschema:applicationName
													</tschema:applicationName>
													<tschema:tierName>tschema:tierName</tschema:tierName>
													<tschema:callBackURL>tschema:callBackURL
													</tschema:callBackURL>
													<tschema:workflowExternalRef>tschema:workflowExternalRef
													</tschema:workflowExternalRef>
													<tschema:operatorID>tschema:operatorID</tschema:operatorID>
													<tschema:authorizedRole>tschema:authorizedRole
													</tschema:authorizedRole>
													<tschema:applicationDescription>tschema:applicationDescription
													</tschema:applicationDescription>
													<tschema:applicationId>tschema:applicationId
													</tschema:applicationId>
													<tschema:apiID>tschema:apiID</tschema:apiID>
												</tschema:SubscriptionApprovalData>
											</bpel:literal>

										</bpel:from>
										<bpel:to variable="input_op_ht_dialog" part="SubscriptionApprovalRequest"></bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiName]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubscriptionApprovalRequest" variable="input_op_ht_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiName]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiVersion]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubscriptionApprovalRequest" variable="input_op_ht_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiVersion]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiContext]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubscriptionApprovalRequest" variable="input_op_ht_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiContext]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiProvider]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubscriptionApprovalRequest" variable="input_op_ht_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiProvider]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:subscriber]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubscriptionApprovalRequest" variable="input_op_ht_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:subscriber]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationName]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubscriptionApprovalRequest" variable="input_op_ht_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationName]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<!-- <bpel:from part="payload" variable="clientRequest"> <bpel:query 
											queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:tierName]]></bpel:query> 
											</bpel:from> -->
										<bpel:from part="SubscriptionApprovalResponse"
											variable="output_ht">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:selectedTier]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubscriptionApprovalRequest" variable="input_op_ht_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:tierName]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:callBackURL]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubscriptionApprovalRequest" variable="input_op_ht_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:callBackURL]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:workflowExternalRef]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubscriptionApprovalRequest" variable="input_op_ht_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:workflowExternalRef]]></bpel:query>
										</bpel:to>
									</bpel:copy>

									<!-- Set Dialog operator ID. -->
									<bpel:copy>
										<bpel:from>
                                            <![CDATA['1']]>
										</bpel:from>
										<bpel:to part="SubscriptionApprovalRequest" variable="input_op_ht_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                                <![CDATA[tns:operatorID]]>
											</bpel:query>
										</bpel:to>
									</bpel:copy>

									<!-- Set Dialog operator role. Operator role is of the syntax: lower-case(<<operator 
										name>>) + '-admin-role' -->
									<bpel:copy>
										<bpel:from>
                                            <![CDATA['dialog-admin-role']]>
										</bpel:from>
										<bpel:to part="SubscriptionApprovalRequest" variable="input_op_ht_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                                <![CDATA[tns:authorizedRole]]>
											</bpel:query>
										</bpel:to>
									</bpel:copy>
									<!-- Set the application description. -->
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationDescription]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubscriptionApprovalRequest" variable="input_op_ht_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationDescription]]></bpel:query>
										</bpel:to>
									</bpel:copy>

									<!-- Set the application Id. -->
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationId]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubscriptionApprovalRequest" variable="input_op_ht_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationId]]></bpel:query>
										</bpel:to>
									</bpel:copy>

									<!-- Set the API Id. -->
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiID]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubscriptionApprovalRequest" variable="input_op_ht_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiID]]></bpel:query>
										</bpel:to>
									</bpel:copy>
								</bpel:assign>

								<!-- Trigger operator approval humantask for Dialog. -->
								<bpel:extensionActivity>
									<b4p:peopleActivity name="subscription_approve_operator"
										inputVariable="input_op_ht_dialog" outputVariable="output_op_ht_dialog">
										<b4p:remoteTask partnerLink="SAPL" operation="approve"
											responseOperation="approvalResponse"></b4p:remoteTask>
									</b4p:peopleActivity>
								</bpel:extensionActivity>
								<bpel:assign validate="no" name="assign_op_output">
									<bpel:copy>
										<bpel:from>
											<bpel:literal>
												<ns:resumeEvent
													xmlns:ns="http://callback.workflow.apimgt.carbon.wso2.org"
													xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
													<ns:workflowReference>ns:workflowReference
													</ns:workflowReference>
													<ns:status>ns:status</ns:status>
													<ns:description>ns:description</ns:description>
												</ns:resumeEvent>
											</bpel:literal>
										</bpel:from>
										<bpel:to part="parameters" variable="input_to_response"></bpel:to>

									</bpel:copy>
									<bpel:copy>
										<bpel:from part="SubscriptionApprovalResponse"
											variable="output_op_ht_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        						<![CDATA[tns:workflowExternalRef]]>
											</bpel:query>
										</bpel:from>
										<bpel:to part="parameters" variable="input_to_response">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        						<![CDATA[ns:workflowReference]]>
											</bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="SubscriptionApprovalResponse"
											variable="output_op_ht_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        						<![CDATA[tns:status]]>
											</bpel:query>
										</bpel:from>
										<bpel:to part="parameters" variable="input_to_response">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        						<![CDATA[ns:status]]>
											</bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="SubscriptionApprovalResponse"
											variable="output_op_ht_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        						<![CDATA[tns:description]]>
											</bpel:query>
										</bpel:from>
										<bpel:to part="parameters" variable="input_to_response">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        						<![CDATA[ns:description]]>
											</bpel:query>
										</bpel:to>
									</bpel:copy>
								</bpel:assign>

								<!-- If operator level admin approved the request. -->
								<!-- <bpel:if name="if_op_admin_approved"> <bpel:condition> <![CDATA[contains($output_op_ht_dialog.SubscriptionApprovalResponse, 
									"APPROVED")]]> </bpel:condition> -->

								<!-- Initialize the operator approval database update request and 
									set input parameter values. -->
								<bpel:sequence>
									<bpel:assign validate="no" name="assign_op_db_input">
										<bpel:copy>
											<bpel:from>
												<bpel:literal>
													<ax:SubOpApprovalDBUpdateRequest
														xmlns:ax="http://org.wso2.carbon/wso2telco/workflow/subscription"
														xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
														<ax:requestType>ax:requestType</ax:requestType>
														<ax:appID>ax:appID</ax:appID>
														<ax:opID>ax:opID</ax:opID>
														<ax:apiName>ax:apiName</ax:apiName>
														<ax:status>ax:status</ax:status>
													</ax:SubOpApprovalDBUpdateRequest>
												</bpel:literal>
											</bpel:from>
											<bpel:to variable="input_op_approval_db" part="SubOpApprovalDBUpdateRequest"></bpel:to>
										</bpel:copy>
										<bpel:copy>
											<bpel:from>
                                			<![CDATA['SUB_OP_APPROVAL']]>
											</bpel:from>
											<bpel:to part="SubOpApprovalDBUpdateRequest"
												variable="input_op_approval_db">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:requestType]]></bpel:query>
											</bpel:to>
										</bpel:copy>
										<bpel:copy>
											<bpel:from part="payload" variable="clientRequest">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationId]]></bpel:query>
											</bpel:from>
											<bpel:to part="SubOpApprovalDBUpdateRequest"
												variable="input_op_approval_db">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:appID]]></bpel:query>
											</bpel:to>
										</bpel:copy>
										<bpel:copy>
											<bpel:from>
                                            <![CDATA['1']]>
											</bpel:from>
											<bpel:to part="SubOpApprovalDBUpdateRequest"
												variable="input_op_approval_db">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:opID]]></bpel:query>
											</bpel:to>
										</bpel:copy>
										<bpel:copy>
											<bpel:from part="payload" variable="clientRequest">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiName]]></bpel:query>
											</bpel:from>
											<bpel:to part="SubOpApprovalDBUpdateRequest"
												variable="input_op_approval_db">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:apiName]]></bpel:query>
											</bpel:to>
										</bpel:copy>
										<bpel:copy>
											<bpel:from part="SubscriptionApprovalResponse"
												variable="output_op_ht_dialog">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        							<![CDATA[tns:status]]>
												</bpel:query>
											</bpel:from>
											<bpel:to part="SubOpApprovalDBUpdateRequest"
												variable="input_op_approval_db">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:status]]></bpel:query>
											</bpel:to>
										</bpel:copy>
									</bpel:assign>

									<!-- Invoke the service to perform operator approval database updates. -->
									<bpel:invoke name="invoke_op_approval_db_update"
										partnerLink="AXSAPL" operation="updateDBSubOpApproval"
										portType="ns2:Wso2telcoWorkflowApprovalServicePT" inputVariable="input_op_approval_db">
									</bpel:invoke>
								</bpel:sequence>
								<!-- </bpel:if> -->

								<bpel:assign validate="no" name="assign_op_au_intput_dialog">
									<bpel:copy>
										<bpel:from>
											<bpel:literal>
												<axau:SubApprovalAuditRequest
													xmlns:axau="http://org.wso2.carbon/wso2telco/workflow/audit"
													xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
													<axau:requestType>axau:requestType</axau:requestType>
													<axau:apiProvider>axau:apiProvider</axau:apiProvider>
													<axau:apiName>axau:apiName</axau:apiName>
													<axau:apiVersion>axau:apiVersion</axau:apiVersion>
													<axau:appId>axau:appId</axau:appId>
													<axau:subStatus>axau:subStatus</axau:subStatus>
													<axau:subApprovalType>axau:subApprovalType
													</axau:subApprovalType>
													<axau:completedByRole>axau:completedByRole
													</axau:completedByRole>
													<axau:completedByUser>axau:completedByUser
													</axau:completedByUser>
													<axau:completedOn>axau:completedOn</axau:completedOn>
												</axau:SubApprovalAuditRequest>
											</bpel:literal>
										</bpel:from>
										<bpel:to variable="input_op_sub_approval_audit_dialog"
											part="SubApprovalAuditRequest"></bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from>
										<![CDATA['SUB_APPROVAL_AUDIT_REQUEST']]>
										</bpel:from>
										<bpel:to part="SubApprovalAuditRequest" variable="input_op_sub_approval_audit_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:requestType]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiProvider]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubApprovalAuditRequest" variable="input_op_sub_approval_audit_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:apiProvider]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiName]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubApprovalAuditRequest" variable="input_op_sub_approval_audit_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:apiName]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiVersion]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubApprovalAuditRequest" variable="input_op_sub_approval_audit_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:apiVersion]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationId]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubApprovalAuditRequest" variable="input_op_sub_approval_audit_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:appId]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="SubscriptionApprovalResponse"
											variable="output_op_ht_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:status]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubApprovalAuditRequest" variable="input_op_sub_approval_audit_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:subStatus]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from>
										<![CDATA['HUB-OPCO-DIALOG']]>
										</bpel:from>
										<bpel:to part="SubApprovalAuditRequest" variable="input_op_sub_approval_audit_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:subApprovalType]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from>
										<![CDATA['dialog-admin-role']]>
										</bpel:from>
										<bpel:to part="SubApprovalAuditRequest" variable="input_op_sub_approval_audit_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:completedByRole]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="SubscriptionApprovalResponse"
											variable="output_op_ht_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:completedByUser]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubApprovalAuditRequest" variable="input_op_sub_approval_audit_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:completedByUser]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="SubscriptionApprovalResponse"
											variable="output_op_ht_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:completedOn]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubApprovalAuditRequest" variable="input_op_sub_approval_audit_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:completedOn]]></bpel:query>
										</bpel:to>
									</bpel:copy>
								</bpel:assign>
								<bpel:invoke name="invoke_op_sub_approval_audit_insert_dialog"
									partnerLink="AAUPL" operation="insertSubApprovalAuditRecord"
									portType="ns2:Wso2telcoWorkflowApprovalServicePT" inputVariable="input_op_sub_approval_audit_dialog">
								</bpel:invoke>

							</bpel:sequence>
						</bpel:if>


						<!-- If operator 'CELCOM' is selected for subscription approval. -->
						<bpel:if name="if_celcom_op_selected">
							<bpel:condition>
                						<![CDATA[contains($output_sub_op_list.SubOperatorRetrievalResponse, 'CELCOM')]]>
							</bpel:condition>

							<!-- Subscription operator approval sequence: Celcom. -->
							<bpel:sequence name="celcom_op_approval_sequence">

								<bpel:if name="if_email_notifications_enabled">
									<bpel:condition>
               						 <![CDATA[false()]]>
									</bpel:condition>
									<bpel:sequence>
										<bpel:assign validate="no"
											name="assign_op_approver_celcom_email_notification">
											<bpel:copy>
												<bpel:from>
													<bpel:literal>
														<axnotify:HUBAdminSubApprovalEmailNotificationRequest
															xmlns:axnotify="http://org.wso2.carbon/wso2telco/workflow/notify"
															xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
															<axnotify:receiverRole>axnotify:receiverRole
															</axnotify:receiverRole>
															<axnotify:apiName>axnotify:apiName</axnotify:apiName>
															<axnotify:apiVersion>axnotify:apiVersion
															</axnotify:apiVersion>
															<axnotify:apiContext>axnotify:apiContext
															</axnotify:apiContext>
															<axnotify:apiProvider>axnotify:apiProvider
															</axnotify:apiProvider>
															<axnotify:subscriber>axnotify:subscriber
															</axnotify:subscriber>
															<axnotify:subscriptionTier>axnotify:subscriptionTier
															</axnotify:subscriptionTier>
															<axnotify:applicationName>axnotify:applicationName
															</axnotify:applicationName>
															<axnotify:applicationDescription>axnotify:applicationDescription
															</axnotify:applicationDescription>
														</axnotify:HUBAdminSubApprovalEmailNotificationRequest>
													</bpel:literal>
												</bpel:from>
												<bpel:to variable="input_op_approver_celcom_email_notification"
													part="HUBAdminSubApprovalEmailNotificationRequest"></bpel:to>
											</bpel:copy>
											<bpel:copy>
												<bpel:from>
                							<![CDATA['celcom-admin-role']]>
												</bpel:from>
												<bpel:to part="HUBAdminSubApprovalEmailNotificationRequest"
													variable="input_op_approver_celcom_email_notification">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:receiverRole]]></bpel:query>
												</bpel:to>
											</bpel:copy>
											<bpel:copy>
												<bpel:from part="payload" variable="clientRequest">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiName]]></bpel:query>
												</bpel:from>
												<bpel:to part="HUBAdminSubApprovalEmailNotificationRequest"
													variable="input_op_approver_celcom_email_notification">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:apiName]]></bpel:query>
												</bpel:to>
											</bpel:copy>
											<bpel:copy>
												<bpel:from part="payload" variable="clientRequest">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiVersion]]></bpel:query>
												</bpel:from>
												<bpel:to part="HUBAdminSubApprovalEmailNotificationRequest"
													variable="input_op_approver_celcom_email_notification">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:apiVersion]]></bpel:query>
												</bpel:to>
											</bpel:copy>
											<bpel:copy>
												<bpel:from part="payload" variable="clientRequest">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiContext]]></bpel:query>
												</bpel:from>
												<bpel:to part="HUBAdminSubApprovalEmailNotificationRequest"
													variable="input_op_approver_celcom_email_notification">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:apiContext]]></bpel:query>
												</bpel:to>
											</bpel:copy>
											<bpel:copy>
												<bpel:from part="payload" variable="clientRequest">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiProvider]]></bpel:query>
												</bpel:from>
												<bpel:to part="HUBAdminSubApprovalEmailNotificationRequest"
													variable="input_op_approver_celcom_email_notification">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:apiProvider]]></bpel:query>
												</bpel:to>
											</bpel:copy>
											<bpel:copy>
												<bpel:from part="payload" variable="clientRequest">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:subscriber]]></bpel:query>
												</bpel:from>
												<bpel:to part="HUBAdminSubApprovalEmailNotificationRequest"
													variable="input_op_approver_celcom_email_notification">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:subscriber]]></bpel:query>
												</bpel:to>
											</bpel:copy>
											<bpel:copy>
												<bpel:from part="SubscriptionApprovalResponse"
													variable="output_ht">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:selectedTier]]></bpel:query>
												</bpel:from>
												<bpel:to part="HUBAdminSubApprovalEmailNotificationRequest"
													variable="input_op_approver_celcom_email_notification">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:subscriptionTier]]></bpel:query>
												</bpel:to>
											</bpel:copy>
											<bpel:copy>
												<bpel:from part="payload" variable="clientRequest">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationName]]></bpel:query>
												</bpel:from>
												<bpel:to part="HUBAdminSubApprovalEmailNotificationRequest"
													variable="input_op_approver_celcom_email_notification">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:applicationName]]></bpel:query>
												</bpel:to>
											</bpel:copy>
											<bpel:copy>
												<bpel:from part="payload" variable="clientRequest">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationDescription]]></bpel:query>
												</bpel:from>
												<bpel:to part="HUBAdminSubApprovalEmailNotificationRequest"
													variable="input_op_approver_celcom_email_notification">
													<bpel:query
														queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:applicationDescription]]></bpel:query>
												</bpel:to>
											</bpel:copy>
										</bpel:assign>
										<bpel:invoke name="invoke_op_approver_celcom_email_notification"
											partnerLink="AXNOTIFYPL" operation="sendHUBAdminSubApprovalEmailNotification"
											portType="axnotify:Wso2telcoWorkflowNotificationServicePT"
											inputVariable="input_op_approver_celcom_email_notification">
										</bpel:invoke>
									</bpel:sequence>
								</bpel:if>

								<!-- Initialize the operator approval humantask request and set input 
									parameters. -->
								<bpel:assign validate="no" name="assign_op_input">
									<bpel:copy>
										<bpel:from>
											<bpel:literal>
												<tschema:SubscriptionApprovalData
													xmlns:tschema="http://workflow.subscription.apimgt.carbon.wso2.org"
													xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
													<tschema:apiName>tschema:apiName</tschema:apiName>
													<tschema:apiVersion>tschema:apiVersion</tschema:apiVersion>
													<tschema:apiContext>tschema:apiContext</tschema:apiContext>
													<tschema:apiProvider>tschema:apiProvider
													</tschema:apiProvider>
													<tschema:subscriber>tschema:subscriber</tschema:subscriber>
													<tschema:applicationName>tschema:applicationName
													</tschema:applicationName>
													<tschema:tierName>tschema:tierName</tschema:tierName>
													<tschema:callBackURL>tschema:callBackURL
													</tschema:callBackURL>
													<tschema:workflowExternalRef>tschema:workflowExternalRef
													</tschema:workflowExternalRef>
													<tschema:operatorID>tschema:operatorID</tschema:operatorID>
													<tschema:authorizedRole>tschema:authorizedRole
													</tschema:authorizedRole>
													<tschema:applicationDescription>tschema:applicationDescription
													</tschema:applicationDescription>
													<tschema:applicationId>tschema:applicationId
													</tschema:applicationId>
													<tschema:apiID>tschema:apiID</tschema:apiID>
												</tschema:SubscriptionApprovalData>
											</bpel:literal>

										</bpel:from>
										<bpel:to variable="input_op_ht_celcom" part="SubscriptionApprovalRequest"></bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiName]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubscriptionApprovalRequest" variable="input_op_ht_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiName]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiVersion]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubscriptionApprovalRequest" variable="input_op_ht_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiVersion]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiContext]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubscriptionApprovalRequest" variable="input_op_ht_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiContext]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiProvider]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubscriptionApprovalRequest" variable="input_op_ht_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiProvider]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:subscriber]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubscriptionApprovalRequest" variable="input_op_ht_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:subscriber]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationName]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubscriptionApprovalRequest" variable="input_op_ht_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationName]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<!-- <bpel:from part="payload" variable="clientRequest"> <bpel:query 
											queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:tierName]]></bpel:query> 
											</bpel:from> -->
										<bpel:from part="SubscriptionApprovalResponse"
											variable="output_ht">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:selectedTier]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubscriptionApprovalRequest" variable="input_op_ht_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:tierName]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:callBackURL]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubscriptionApprovalRequest" variable="input_op_ht_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:callBackURL]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:workflowExternalRef]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubscriptionApprovalRequest" variable="input_op_ht_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:workflowExternalRef]]></bpel:query>
										</bpel:to>
									</bpel:copy>

									<!-- Set Celcom operator ID. -->
									<bpel:copy>
										<bpel:from>
                                            <![CDATA['2']]>
										</bpel:from>
										<bpel:to part="SubscriptionApprovalRequest" variable="input_op_ht_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                                <![CDATA[tns:operatorID]]>
											</bpel:query>
										</bpel:to>
									</bpel:copy>

									<!-- Set Dialog operator role. Operator role is of the syntax: lower-case(<<operator 
										name>>) + '-admin-role' -->
									<bpel:copy>
										<bpel:from>
                                            <![CDATA['celcom-admin-role']]>
										</bpel:from>
										<bpel:to part="SubscriptionApprovalRequest" variable="input_op_ht_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                                <![CDATA[tns:authorizedRole]]>
											</bpel:query>
										</bpel:to>
									</bpel:copy>
									<!-- Set the application description. -->
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationDescription]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubscriptionApprovalRequest" variable="input_op_ht_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationDescription]]></bpel:query>
										</bpel:to>
									</bpel:copy>

									<!-- Set the application Id. -->
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationId]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubscriptionApprovalRequest" variable="input_op_ht_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationId]]></bpel:query>
										</bpel:to>
									</bpel:copy>

									<!-- Set the API Id. -->
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiID]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubscriptionApprovalRequest" variable="input_op_ht_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiID]]></bpel:query>
										</bpel:to>
									</bpel:copy>
								</bpel:assign>

								<!-- Trigger operator approval humantask for Dialog. -->
								<bpel:extensionActivity>
									<b4p:peopleActivity name="subscription_approve_operator"
										inputVariable="input_op_ht_celcom" outputVariable="output_op_ht_celcom">
										<b4p:remoteTask partnerLink="SAPL" operation="approve"
											responseOperation="approvalResponse"></b4p:remoteTask>
									</b4p:peopleActivity>
								</bpel:extensionActivity>
								<bpel:assign validate="no" name="assign_op_output">
									<bpel:copy>
										<bpel:from>
											<bpel:literal>
												<ns:resumeEvent
													xmlns:ns="http://callback.workflow.apimgt.carbon.wso2.org"
													xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
													<ns:workflowReference>ns:workflowReference
													</ns:workflowReference>
													<ns:status>ns:status</ns:status>
													<ns:description>ns:description</ns:description>
												</ns:resumeEvent>
											</bpel:literal>
										</bpel:from>
										<bpel:to part="parameters" variable="input_to_response"></bpel:to>

									</bpel:copy>
									<bpel:copy>
										<bpel:from part="SubscriptionApprovalResponse"
											variable="output_op_ht_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        						<![CDATA[tns:workflowExternalRef]]>
											</bpel:query>
										</bpel:from>
										<bpel:to part="parameters" variable="input_to_response">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        						<![CDATA[ns:workflowReference]]>
											</bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="SubscriptionApprovalResponse"
											variable="output_op_ht_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        						<![CDATA[tns:status]]>
											</bpel:query>
										</bpel:from>
										<bpel:to part="parameters" variable="input_to_response">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        						<![CDATA[ns:status]]>
											</bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="SubscriptionApprovalResponse"
											variable="output_op_ht_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        						<![CDATA[tns:description]]>
											</bpel:query>
										</bpel:from>
										<bpel:to part="parameters" variable="input_to_response">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        						<![CDATA[ns:description]]>
											</bpel:query>
										</bpel:to>
									</bpel:copy>
								</bpel:assign>

								<!-- If operator level admin approved the request. -->
								<!-- <bpel:if name="if_op_admin_approved"> <bpel:condition> <![CDATA[contains($output_op_ht_celcom.SubscriptionApprovalResponse, 
									"APPROVED")]]> </bpel:condition> -->

								<!-- Initialize the operator approval database update request and 
									set input parameter values. -->
								<bpel:sequence>
									<bpel:assign validate="no" name="assign_op_db_input">
										<bpel:copy>
											<bpel:from>
												<bpel:literal>
													<ax:SubOpApprovalDBUpdateRequest
														xmlns:ax="http://org.wso2.carbon/wso2telco/workflow/subscription"
														xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
														<ax:requestType>ax:requestType</ax:requestType>
														<ax:appID>ax:appID</ax:appID>
														<ax:opID>ax:opID</ax:opID>
														<ax:apiName>ax:apiName</ax:apiName>
														<ax:status>ax:status</ax:status>
													</ax:SubOpApprovalDBUpdateRequest>
												</bpel:literal>
											</bpel:from>
											<bpel:to variable="input_op_approval_db" part="SubOpApprovalDBUpdateRequest"></bpel:to>
										</bpel:copy>
										<bpel:copy>
											<bpel:from>
                                			<![CDATA['SUB_OP_APPROVAL']]>
											</bpel:from>
											<bpel:to part="SubOpApprovalDBUpdateRequest"
												variable="input_op_approval_db">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:requestType]]></bpel:query>
											</bpel:to>
										</bpel:copy>
										<bpel:copy>
											<bpel:from part="payload" variable="clientRequest">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationId]]></bpel:query>
											</bpel:from>
											<bpel:to part="SubOpApprovalDBUpdateRequest"
												variable="input_op_approval_db">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:appID]]></bpel:query>
											</bpel:to>
										</bpel:copy>
										<bpel:copy>
											<bpel:from>
                                            <![CDATA['2']]>
											</bpel:from>
											<bpel:to part="SubOpApprovalDBUpdateRequest"
												variable="input_op_approval_db">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:opID]]></bpel:query>
											</bpel:to>
										</bpel:copy>
										<bpel:copy>
											<bpel:from part="payload" variable="clientRequest">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiName]]></bpel:query>
											</bpel:from>
											<bpel:to part="SubOpApprovalDBUpdateRequest"
												variable="input_op_approval_db">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:apiName]]></bpel:query>
											</bpel:to>
										</bpel:copy>
										<bpel:copy>
											<bpel:from part="SubscriptionApprovalResponse"
												variable="output_op_ht_celcom">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        							<![CDATA[tns:status]]>
												</bpel:query>
											</bpel:from>
											<bpel:to part="SubOpApprovalDBUpdateRequest"
												variable="input_op_approval_db">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:status]]></bpel:query>
											</bpel:to>
										</bpel:copy>
									</bpel:assign>

									<!-- Invoke the service to perform operator approval database updates. -->
									<bpel:invoke name="invoke_op_approval_db_update"
										partnerLink="AXSAPL" operation="updateDBSubOpApproval"
										portType="ns2:Wso2telcoWorkflowApprovalServicePT" inputVariable="input_op_approval_db">
									</bpel:invoke>
								</bpel:sequence>
								<!-- </bpel:if> -->

								<bpel:assign validate="no" name="assign_op_au_intput_celcom">
									<bpel:copy>
										<bpel:from>
											<bpel:literal>
												<axau:SubApprovalAuditRequest
													xmlns:axau="http://org.wso2.carbon/wso2telco/workflow/audit"
													xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
													<axau:requestType>axau:requestType</axau:requestType>
													<axau:apiProvider>axau:apiProvider</axau:apiProvider>
													<axau:apiName>axau:apiName</axau:apiName>
													<axau:apiVersion>axau:apiVersion</axau:apiVersion>
													<axau:appId>axau:appId</axau:appId>
													<axau:subStatus>axau:subStatus</axau:subStatus>
													<axau:subApprovalType>axau:subApprovalType
													</axau:subApprovalType>
													<axau:completedByRole>axau:completedByRole
													</axau:completedByRole>
													<axau:completedByUser>axau:completedByUser
													</axau:completedByUser>
													<axau:completedOn>axau:completedOn</axau:completedOn>
												</axau:SubApprovalAuditRequest>
											</bpel:literal>
										</bpel:from>
										<bpel:to variable="input_op_sub_approval_audit_celcom"
											part="SubApprovalAuditRequest"></bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from>
										<![CDATA['SUB_APPROVAL_AUDIT_REQUEST']]>
										</bpel:from>
										<bpel:to part="SubApprovalAuditRequest" variable="input_op_sub_approval_audit_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:requestType]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiProvider]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubApprovalAuditRequest" variable="input_op_sub_approval_audit_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:apiProvider]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiName]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubApprovalAuditRequest" variable="input_op_sub_approval_audit_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:apiName]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:apiVersion]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubApprovalAuditRequest" variable="input_op_sub_approval_audit_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:apiVersion]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationId]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubApprovalAuditRequest" variable="input_op_sub_approval_audit_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:appId]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="SubscriptionApprovalResponse"
											variable="output_op_ht_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:status]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubApprovalAuditRequest" variable="input_op_sub_approval_audit_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:subStatus]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from>
										<![CDATA['HUB-OPCO-DIALOG']]>
										</bpel:from>
										<bpel:to part="SubApprovalAuditRequest" variable="input_op_sub_approval_audit_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:subApprovalType]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from>
										<![CDATA['celcom-admin-role']]>
										</bpel:from>
										<bpel:to part="SubApprovalAuditRequest" variable="input_op_sub_approval_audit_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:completedByRole]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="SubscriptionApprovalResponse"
											variable="output_op_ht_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:completedByUser]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubApprovalAuditRequest" variable="input_op_sub_approval_audit_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:completedByUser]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="SubscriptionApprovalResponse"
											variable="output_op_ht_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:completedOn]]></bpel:query>
										</bpel:from>
										<bpel:to part="SubApprovalAuditRequest" variable="input_op_sub_approval_audit_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:completedOn]]></bpel:query>
										</bpel:to>
									</bpel:copy>
								</bpel:assign>
								<bpel:invoke name="invoke_op_sub_approval_audit_insert_celcom"
									partnerLink="AAUPL" operation="insertSubApprovalAuditRecord"
									portType="ns2:Wso2telcoWorkflowApprovalServicePT" inputVariable="input_op_sub_approval_audit_celcom">
								</bpel:invoke>

							</bpel:sequence>
						</bpel:if>
					</bpel:flow>
				</bpel:sequence>
			</bpel:if>
		</bpel:sequence>
	</bpel:sequence>
</bpel:process>
