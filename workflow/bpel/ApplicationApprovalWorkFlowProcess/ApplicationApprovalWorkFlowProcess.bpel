<!-- ApplicationApprovalWorkFlowProcess BPEL Process [Generated by the Eclipse 
	BPEL Designer] -->
<!-- Date: Mon Mar 05 12:18:58 IST 2012 -->

<bpel:process name="ApplicationApprovalWorkFlowProcess"
	targetNamespace="http://workflow.application.apimgt.carbon.wso2.org"
	suppressJoinFailure="yes"
	xmlns:tns="http://workflow.application.apimgt.carbon.wso2.org"
	xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
	xmlns:b4p="http://docs.oasis-open.org/ns/bpel4people/bpel4people/200803"
	xmlns:ns1="http://org.wso2.carbon/applications/" xmlns:ns2="http://org.wso2.carbon/axiata/workflow"
	xmlns:ns3="http://org.wso2.carbon/axiata/workflow/application"
	xmlns:ns="http://callback.workflow.apimgt.carbon.wso2.org"
	queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath2.0"
	expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath2.0"
	xmlns:axau="http://org.wso2.carbon/axiata/workflow/audit"
	xmlns:axnotify="http://org.wso2.carbon/axiata/workflow/notify">

	<!-- Import the client WSDL -->
	<bpel:extensions>
		<bpel:extension
			namespace="http://docs.oasis-open.org/ns/bpel4people/bpel4people/200803"
			mustUnderstand="yes">
		</bpel:extension>
	</bpel:extensions>
	<bpel:import namespace="http://org.wso2.carbon/applications/"
		location="ApplicationsApprovalTaskService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
	<bpel:import namespace="http://org.wso2.carbon/applications/"
		location="ApplicationsApprovalTaskService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
	<bpel:import namespace="http://workflow.application.apimgt.carbon.wso2.org"
		location="ApplicationApprovalWorkFlowProcessArtifacts.wsdl"
		importType="http://schemas.xmlsoap.org/wsdl/" />
	<bpel:import namespace="http://org.wso2.carbon/axiata/workflow"
		location="AxiataWorkflowApprovalService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
	<!-- <bpel:import namespace="http://org.wso2.carbon/axiata/workflow/audit" 
		location="AxiataWorkflowApprovalAuditService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import> -->
	<bpel:import namespace="http://org.wso2.carbon/axiata/workflow/notify"
		location="AxiataWorkflowNotificationService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>

	<!-- ================================================================= -->
	<!-- PARTNERLINKS -->
	<!-- List of services participating in this BPEL process -->
	<!-- ================================================================= -->
	<bpel:partnerLinks>
		<!-- The 'client' role represents the requester of this service. It is 
			used for callback. The location and correlation information associated with 
			the client role are automatically set using WS-Addressing. -->
		<bpel:partnerLink name="client"
			partnerLinkType="tns:ApplicationApprovalWorkFlowProcess" myRole="ApplicationApprovalWorkFlowProcessProvider"
			partnerRole="ApplicationApprovalWorkFlowProcessRequester" />
		<bpel:partnerLink name="AAPL" partnerLinkType="tns:AAPLT"
			myRole="role2" partnerRole="role1"></bpel:partnerLink>
		<bpel:partnerLink name="CBPL" partnerLinkType="tns:CBPLT"
			partnerRole="role3"></bpel:partnerLink>
		<bpel:partnerLink name="AAOPPL" partnerLinkType="tns:AAOPPLT"
			partnerRole="axiataDBHandlerRole" initializePartnerRole="yes"></bpel:partnerLink>
		<bpel:partnerLink name="AAUPL" partnerLinkType="tns:AAUPLT"
			partnerRole="axiataAuditRole" initializePartnerRole="yes"></bpel:partnerLink>
		<bpel:partnerLink name="AXNOTIFYPL" partnerLinkType="tns:AXNOTIFYPLT"
			partnerRole="axiataNotifyRole" initializePartnerRole="yes"></bpel:partnerLink>
	</bpel:partnerLinks>

	<!-- ================================================================= -->
	<!-- VARIABLES -->
	<!-- List of messages and XML documents used within this BPEL process -->
	<!-- ================================================================= -->
	<bpel:variables>
		<!-- Reference to the message passed as input during initiation -->
		<bpel:variable name="input"
			messageType="tns:ApplicationApprovalWorkFlowProcessRequestMessage" />

		<!-- Reference to the message that will be sent back to the requester during 
			callback -->
		<bpel:variable name="output" messageType="ns1:ApplicationApprovalResponse" />
		<bpel:variable name="input_ht" messageType="ns1:ApplicationApprovalRequest"></bpel:variable>
		<bpel:variable name="output_ht" messageType="ns1:ApplicationApprovalResponse"></bpel:variable>
		<bpel:variable name="clientRequest"
			messageType="tns:ApplicationApprovalWorkFlowProcessRequestMessage"></bpel:variable>
		<bpel:variable name="CBPLRequest" messageType="ns:resumeEventRequest"></bpel:variable>
		<!-- <bpel:variable name="input_op_ht" messageType="ns1:ApplicationApprovalRequest"></bpel:variable> 
			<bpel:variable name="output_op_ht" messageType="ns1:ApplicationApprovalResponse"></bpel:variable> -->
		<bpel:variable name="input_hub_approval_db" messageType="ns2:AppHUBApprovalDBUpdateRequest"></bpel:variable>

		<bpel:variable name="input_op_approval_db_dialog"
			messageType="ns2:AppOpApprovalDBUpdateRequest"></bpel:variable>
		<bpel:variable name="input_op_approval_db_celcom"
			messageType="ns2:AppOpApprovalDBUpdateRequest"></bpel:variable>

		<bpel:variable name="input_op_ht_dialog" messageType="ns1:ApplicationApprovalRequest"></bpel:variable>
		<bpel:variable name="input_op_ht_celcom" messageType="ns1:ApplicationApprovalRequest"></bpel:variable>
		<bpel:variable name="output_op_ht_dialog" messageType="ns1:ApplicationApprovalResponse"></bpel:variable>
		<bpel:variable name="output_op_ht_celcom" messageType="ns1:ApplicationApprovalResponse"></bpel:variable>

		<bpel:variable name="input_hub_app_approval_audit"
			messageType="ns2:AppApprovalAuditRequest"></bpel:variable>
		<bpel:variable name="input_op_app_approval_audit_dialog"
			messageType="ns2:AppApprovalAuditRequest"></bpel:variable>
		<bpel:variable name="input_op_app_approval_audit_celcom"
			messageType="ns2:AppApprovalAuditRequest"></bpel:variable>

		<bpel:variable name="input_hub_approver_email_notification"
			messageType="axnotify:HUBAdminAppApprovalEmailNotificationRequest" />
		<bpel:variable name="input_op_approver_dialog_email_notification"
			messageType="axnotify:HUBAdminAppApprovalEmailNotificationRequest" />
		<bpel:variable name="input_op_approver_celcom_email_notification"
			messageType="axnotify:HUBAdminAppApprovalEmailNotificationRequest" />
		<bpel:variable name="input_approval_status_sp_email_notification"
			messageType="axnotify:AppApprovalStatusSPEmailNotificationRequest" />

	</bpel:variables>

	<!-- ================================================================= -->
	<!-- ORCHESTRATION LOGIC -->
	<!-- Set of activities coordinating the flow of messages across the -->
	<!-- services integrated within this business process -->
	<!-- ================================================================= -->
	<bpel:sequence name="main">

		<!-- Receive input from requestor. Note: This maps to operation defined 
			in ApplicationApprovalWorkFlowProcess.wsdl -->
		<bpel:receive name="receiveInput" partnerLink="client"
			createInstance="yes" operation="initiate"
			portType="tns:ApplicationApprovalWorkFlowProcess" variable="clientRequest" />

		<bpel:if name="if_email_notifications_enabled">
			<bpel:condition>
                <![CDATA[false()]]>
			</bpel:condition>
			<bpel:sequence>
				<bpel:assign validate="no"
					name="assign_hub_approver_email_notification">
					<bpel:copy>
						<bpel:from>
							<bpel:literal>
								<axnotify:HUBAdminAppApprovalEmailNotificationRequest
									xmlns:axnotify="http://org.wso2.carbon/axiata/workflow/notify"
									xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
									<axnotify:receiverRole>axnotify:receiverRole
									</axnotify:receiverRole>
									<axnotify:applicationName>axnotify:applicationName
									</axnotify:applicationName>
									<axnotify:applicationTier>axnotify:applicationTier
									</axnotify:applicationTier>
									<axnotify:applicationDescription>axnotify:applicationDescription
									</axnotify:applicationDescription>
									<axnotify:userName>axnotify:userName</axnotify:userName>
								</axnotify:HUBAdminAppApprovalEmailNotificationRequest>
							</bpel:literal>
						</bpel:from>
						<bpel:to variable="input_hub_approver_email_notification"
							part="HUBAdminAppApprovalEmailNotificationRequest"></bpel:to>
					</bpel:copy>
					<bpel:copy>
						<bpel:from>
					<![CDATA['admin']]>
						</bpel:from>
						<bpel:to part="HUBAdminAppApprovalEmailNotificationRequest"
							variable="input_hub_approver_email_notification">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:receiverRole]]></bpel:query>
						</bpel:to>
					</bpel:copy>
					<bpel:copy>
						<bpel:from part="payload" variable="clientRequest">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationName]]></bpel:query>
						</bpel:from>
						<bpel:to part="HUBAdminAppApprovalEmailNotificationRequest"
							variable="input_hub_approver_email_notification">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:applicationName]]></bpel:query>
						</bpel:to>
					</bpel:copy>
					<bpel:copy>
						<bpel:from part="payload" variable="clientRequest">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationTier]]></bpel:query>
						</bpel:from>
						<bpel:to part="HUBAdminAppApprovalEmailNotificationRequest"
							variable="input_hub_approver_email_notification">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:applicationTier]]></bpel:query>
						</bpel:to>
					</bpel:copy>
					<bpel:copy>
						<bpel:from part="payload" variable="clientRequest">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationDescription]]></bpel:query>
						</bpel:from>
						<bpel:to part="HUBAdminAppApprovalEmailNotificationRequest"
							variable="input_hub_approver_email_notification">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:applicationDescription]]></bpel:query>
						</bpel:to>
					</bpel:copy>
					<bpel:copy>
						<bpel:from part="payload" variable="clientRequest">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:userName]]></bpel:query>
						</bpel:from>
						<bpel:to part="HUBAdminAppApprovalEmailNotificationRequest"
							variable="input_hub_approver_email_notification">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:userName]]></bpel:query>
						</bpel:to>
					</bpel:copy>
				</bpel:assign>
				<bpel:invoke name="invoke_hub_approver_email_notification"
					partnerLink="AXNOTIFYPL" operation="sendHUBAdminAppApprovalEmailNotification"
					portType="axnotify:AxiataWorkflowNotificationServicePT"
					inputVariable="input_hub_approver_email_notification">
				</bpel:invoke>
			</bpel:sequence>
		</bpel:if>

		<!-- Initialize the HUB approval request and set input parameter values. -->
		<bpel:assign validate="no" name="assign_hub_input">
			<bpel:copy>
				<bpel:from>
					<bpel:literal>
						<tschema:ApplicationApprovalData
							xmlns:tschema="http://workflow.application.apimgt.carbon.wso2.org"
							xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
							<tschema:applicationName>tschema:applicationName
							</tschema:applicationName>
							<tschema:applicationId>tschema:applicationId
							</tschema:applicationId>
							<tschema:applicationTier>tschema:applicationTier
							</tschema:applicationTier>
							<tschema:applicationCallbackUrl>tschema:applicationCallbackUrl
							</tschema:applicationCallbackUrl>
							<tschema:applicationDescription>tschema:applicationDescription
							</tschema:applicationDescription>
							<tschema:tenantDomain>tschema:tenantDomain</tschema:tenantDomain>
							<tschema:userName>tschema:userName</tschema:userName>
							<tschema:workflowExternalRef>tschema:workflowExternalRef
							</tschema:workflowExternalRef>
							<tschema:callBackURL>tschema:callBackURL</tschema:callBackURL>
							<tschema:operatorID>tschema:operatorID</tschema:operatorID>
							<tschema:authorizedRole>tschema:authorizedRole
							</tschema:authorizedRole>
							<tschema:tiers>tschema:tiers</tschema:tiers>
						</tschema:ApplicationApprovalData>
					</bpel:literal>
				</bpel:from>
				<bpel:to variable="input_ht" part="ApplicationApprovalRequest"></bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationName]]></bpel:query>
				</bpel:from>
				<bpel:to part="ApplicationApprovalRequest" variable="input_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationName]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationTier]]></bpel:query>
				</bpel:from>
				<bpel:to part="ApplicationApprovalRequest" variable="input_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationTier]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationCallbackUrl]]></bpel:query>
				</bpel:from>
				<bpel:to part="ApplicationApprovalRequest" variable="input_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationCallbackUrl]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationDescription]]></bpel:query>
				</bpel:from>
				<bpel:to part="ApplicationApprovalRequest" variable="input_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationDescription]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:tenantDomain]]></bpel:query>
				</bpel:from>
				<bpel:to part="ApplicationApprovalRequest" variable="input_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:tenantDomain]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:userName]]></bpel:query>
				</bpel:from>
				<bpel:to part="ApplicationApprovalRequest" variable="input_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:userName]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:workflowExternalRef]]></bpel:query>
				</bpel:from>
				<bpel:to part="ApplicationApprovalRequest" variable="input_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:workflowExternalRef]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:callBackURL]]></bpel:query>
				</bpel:from>
				<bpel:to part="ApplicationApprovalRequest" variable="input_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:callBackURL]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<!-- Set the default operator id for HUB admin user. This is just a dummy 
				value passed in the request, and not used for any processing. -->
			<bpel:copy>
				<bpel:from>
					<![CDATA['0']]>
				</bpel:from>
				<bpel:to part="ApplicationApprovalRequest" variable="input_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
						<![CDATA[tns:operatorID]]>
					</bpel:query>
				</bpel:to>
			</bpel:copy>
			<!-- Set the role 'admin' for HUB level workflow administrator. -->
			<bpel:copy>
				<bpel:from>
					<![CDATA['admin']]>
				</bpel:from>
				<bpel:to part="ApplicationApprovalRequest" variable="input_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
						<![CDATA[tns:authorizedRole]]>
					</bpel:query>
				</bpel:to>
			</bpel:copy>
			<!-- Set the list of available tiers for application creation. -->
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:tiers]]></bpel:query>
				</bpel:from>
				<bpel:to part="ApplicationApprovalRequest" variable="input_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:tiers]]></bpel:query>
				</bpel:to>
			</bpel:copy>
		</bpel:assign>

		<!-- Asynchronous callback to the requester. Note: the callback location 
			and correlation id is transparently handled using WS-addressing. -->
		<!-- Trigger HUB approval humantask. -->
		<bpel:extensionActivity>
			<b4p:peopleActivity name="approve_application"
				inputVariable="input_ht" outputVariable="output_ht">
				<b4p:remoteTask partnerLink="AAPL" operation="approve"
					responseOperation="approvalResponse"></b4p:remoteTask>
			</b4p:peopleActivity>
		</bpel:extensionActivity>

		<!-- Obtain the HUB apporval response values. -->
		<bpel:assign validate="no" name="assign_hub_output">
			<bpel:copy>
				<bpel:from>
					<bpel:literal>
						<ns:resumeEvent xmlns:ns="http://callback.workflow.apimgt.carbon.wso2.org"
							xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
							<ns:workflowReference>ns:workflowReference</ns:workflowReference>
							<ns:status>ns:status</ns:status>
							<ns:description>ns:description</ns:description>
						</ns:resumeEvent>
					</bpel:literal>
				</bpel:from>
				<bpel:to variable="CBPLRequest" part="parameters"></bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="ApplicationApprovalResponse" variable="output_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:workflowExternalRef]]>
					</bpel:query>
				</bpel:from>
				<bpel:to part="parameters" variable="CBPLRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:workflowReference]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="ApplicationApprovalResponse" variable="output_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:status]]>
					</bpel:query>
				</bpel:from>
				<bpel:to part="parameters" variable="CBPLRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:status]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="ApplicationApprovalResponse" variable="output_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:description]]></bpel:query>
				</bpel:from>
				<bpel:to part="parameters" variable="CBPLRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:description]]></bpel:query>
				</bpel:to>
			</bpel:copy>
		</bpel:assign>

		<!-- Invoke HUB callback request with the HUB approval status details. -->
		<bpel:invoke name="invoke_hub_callback" partnerLink="CBPL"
			operation="resumeEvent" portType="ns:WorkflowCallbackServicePortType"
			inputVariable="CBPLRequest"></bpel:invoke>

		<!-- [START] Trigger email notification to the SP with the App approval 
			status. -->
		<bpel:if name="if_email_notifications_enabled">
			<bpel:condition>
                <![CDATA[false()]]>
			</bpel:condition>

			<bpel:sequence>
				<bpel:assign validate="no"
					name="assign_approval_status_sp_email_notification">
					<bpel:copy>
						<bpel:from>
							<bpel:literal>
								<axnotify:AppApprovalStatusSPEmailNotificationRequest
									xmlns:axnotify="http://org.wso2.carbon/axiata/workflow/notify"
									xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
									<axnotify:applicationName>axnotify:applicationName
									</axnotify:applicationName>
									<axnotify:applicationTier>axnotify:applicationTier
									</axnotify:applicationTier>
									<axnotify:applicationDescription>axnotify:applicationDescription
									</axnotify:applicationDescription>
									<axnotify:userName>axnotify:userName</axnotify:userName>
									<axnotify:approvalStatus>axnotify:approvalStatus
									</axnotify:approvalStatus>
								</axnotify:AppApprovalStatusSPEmailNotificationRequest>
							</bpel:literal>
						</bpel:from>
						<bpel:to variable="input_approval_status_sp_email_notification"
							part="AppApprovalStatusSPEmailNotificationRequest"></bpel:to>
					</bpel:copy>
					<bpel:copy>
						<bpel:from part="payload" variable="clientRequest">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationName]]></bpel:query>
						</bpel:from>
						<bpel:to part="AppApprovalStatusSPEmailNotificationRequest"
							variable="input_approval_status_sp_email_notification">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:applicationName]]></bpel:query>
						</bpel:to>
					</bpel:copy>
					<bpel:copy>
						<bpel:from part="ApplicationApprovalResponse" variable="output_ht">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:selectedTier]]></bpel:query>
						</bpel:from>
						<bpel:to part="AppApprovalStatusSPEmailNotificationRequest"
							variable="input_approval_status_sp_email_notification">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:applicationTier]]></bpel:query>
						</bpel:to>
					</bpel:copy>
					<bpel:copy>
						<bpel:from part="payload" variable="clientRequest">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationDescription]]></bpel:query>
						</bpel:from>
						<bpel:to part="AppApprovalStatusSPEmailNotificationRequest"
							variable="input_approval_status_sp_email_notification">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:applicationDescription]]></bpel:query>
						</bpel:to>
					</bpel:copy>
					<bpel:copy>
						<bpel:from part="payload" variable="clientRequest">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:userName]]></bpel:query>
						</bpel:from>
						<bpel:to part="AppApprovalStatusSPEmailNotificationRequest"
							variable="input_approval_status_sp_email_notification">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:userName]]></bpel:query>
						</bpel:to>
					</bpel:copy>
					<bpel:copy>
						<bpel:from part="ApplicationApprovalResponse" variable="output_ht">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:status]]></bpel:query>
						</bpel:from>
						<bpel:to part="AppApprovalStatusSPEmailNotificationRequest"
							variable="input_approval_status_sp_email_notification">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:approvalStatus]]></bpel:query>
						</bpel:to>
					</bpel:copy>
				</bpel:assign>
				<bpel:invoke name="invoke_approval_status_sp_email_notification"
					partnerLink="AXNOTIFYPL" operation="sendAppApprovalStatusSPEmailNotification"
					portType="axnotify:AxiataWorkflowNotificationServicePT"
					inputVariable="input_approval_status_sp_email_notification">
				</bpel:invoke>
			</bpel:sequence>
		</bpel:if>
		<!-- [END] Approval status SP email notification. -->

		<!-- Publish audit data related to HUB approval. -->
		<bpel:assign validate="no" name="assign_hub_au_intput">
			<bpel:copy>
				<bpel:from>
					<bpel:literal>
						<axau:AppApprovalAuditRequest
							xmlns:axau="http://org.wso2.carbon/axiata/workflow/audit"
							xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
							<axau:requestType>axau:requestType</axau:requestType>
							<axau:appName>axau:appName</axau:appName>
							<axau:appCreator>axau:appCreator</axau:appCreator>
							<axau:appStatus>axau:appStatus</axau:appStatus>
							<axau:appApprovalType>axau:appApprovalType</axau:appApprovalType>
							<axau:completedByRole>axau:completedByRole</axau:completedByRole>
							<axau:completedByUser>axau:completedByUser</axau:completedByUser>
							<axau:completedOn>axau:completedOn</axau:completedOn>
						</axau:AppApprovalAuditRequest>
					</bpel:literal>
				</bpel:from>
				<bpel:to variable="input_hub_app_approval_audit" part="AppApprovalAuditRequest"></bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from>
					<![CDATA['APP_APPROVAL_AUDIT_REQUEST']]>
				</bpel:from>
				<bpel:to part="AppApprovalAuditRequest" variable="input_hub_app_approval_audit">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:requestType]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationName]]></bpel:query>
				</bpel:from>
				<bpel:to part="AppApprovalAuditRequest" variable="input_hub_app_approval_audit">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:appName]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="clientRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:userName]]></bpel:query>
				</bpel:from>
				<bpel:to part="AppApprovalAuditRequest" variable="input_hub_app_approval_audit">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:appCreator]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="ApplicationApprovalResponse" variable="output_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:status]]></bpel:query>
				</bpel:from>
				<bpel:to part="AppApprovalAuditRequest" variable="input_hub_app_approval_audit">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:appStatus]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from>
					<![CDATA['HUB_ADMIN']]>
				</bpel:from>
				<bpel:to part="AppApprovalAuditRequest" variable="input_hub_app_approval_audit">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:appApprovalType]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from>
					<![CDATA['admin']]>
				</bpel:from>
				<bpel:to part="AppApprovalAuditRequest" variable="input_hub_app_approval_audit">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:completedByRole]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="ApplicationApprovalResponse" variable="output_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:completedByUser]]></bpel:query>
				</bpel:from>
				<bpel:to part="AppApprovalAuditRequest" variable="input_hub_app_approval_audit">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:completedByUser]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="ApplicationApprovalResponse" variable="output_ht">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:completedOn]]></bpel:query>
				</bpel:from>
				<bpel:to part="AppApprovalAuditRequest" variable="input_hub_app_approval_audit">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:completedOn]]></bpel:query>
				</bpel:to>
			</bpel:copy>
		</bpel:assign>
		<bpel:invoke name="invoke_hub_app_approval_audit_insert"
			partnerLink="AAUPL" operation="insertAppApprovalAuditRecord"
			portType="ns2:AxiataWorkflowApprovalServicePT" inputVariable="input_hub_app_approval_audit">
		</bpel:invoke>

		<!-- Execute sequence containing operator approval workflow logic. -->
		<bpel:sequence name="op_approval_sequence">

			<!-- If HUB admin has approved the request. -->
			<bpel:if name="if_hub_admin_approved">
				<bpel:condition>
                <![CDATA[contains($output_ht.ApplicationApprovalResponse, "APPROVED")]]>
				</bpel:condition>
				<bpel:sequence>

					<!-- Initialize the HUB approval database update request and set input 
						parameter values. -->
					<bpel:assign validate="no" name="assign_hub_db_input">
						<bpel:copy>
							<bpel:from>
								<bpel:literal xml:space="preserve">
                                	<ax:AppHUBApprovalDBUpdateRequest
									xmlns:ax="http://org.wso2.carbon/axiata/workflow/application"
									xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                                    	<ax:requestType>ax:requestType</ax:requestType>
  										<ax:appID>ax:appID</ax:appID>
                                    </ax:AppHUBApprovalDBUpdateRequest></bpel:literal>
							</bpel:from>
							<bpel:to part="AppHUBApprovalDBUpdateRequest" variable="input_hub_approval_db"></bpel:to>
						</bpel:copy>
						<bpel:copy>
							<bpel:from>
                                <![CDATA['HUB_APPROVAL']]>
							</bpel:from>
							<bpel:to part="AppHUBApprovalDBUpdateRequest" variable="input_hub_approval_db">
								<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:requestType]]></bpel:query>
							</bpel:to>
						</bpel:copy>
						<bpel:copy>
							<bpel:from part="payload" variable="clientRequest">
								<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationId]]></bpel:query>
							</bpel:from>
							<bpel:to part="AppHUBApprovalDBUpdateRequest" variable="input_hub_approval_db">
								<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:appID]]></bpel:query>
							</bpel:to>
						</bpel:copy>
					</bpel:assign>

					<!-- Invoke the service call to perform HUB approval DB updates. -->
					<bpel:invoke name="invoke_hub_approval_db_update"
						partnerLink="AAOPPL" operation="updateDBAppHubApproval"
						portType="ns2:AxiataWorkflowApprovalServicePT" inputVariable="input_hub_approval_db">
					</bpel:invoke>

					<!-- For each operator, perform the following activities. -->
					<bpel:flow name="op_approval_flow">
						<!-- Operator approval sequence: Dialog -->
						<bpel:sequence name="dialog_op_approval_sequence">

							<bpel:if name="if_email_notifications_enabled">
								<bpel:condition>
               						 <![CDATA[false()]]>
								</bpel:condition>
								<bpel:sequence>
									<bpel:assign validate="no"
										name="assign_op_approver_dialog_email_notification">
										<bpel:copy>
											<bpel:from>
												<bpel:literal>
													<axnotify:HUBAdminAppApprovalEmailNotificationRequest
														xmlns:axnotify="http://org.wso2.carbon/axiata/workflow/notify"
														xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
														<axnotify:receiverRole>axnotify:receiverRole
														</axnotify:receiverRole>
														<axnotify:applicationName>axnotify:applicationName
														</axnotify:applicationName>
														<axnotify:applicationTier>axnotify:applicationTier
														</axnotify:applicationTier>
														<axnotify:applicationDescription>axnotify:applicationDescription
														</axnotify:applicationDescription>
														<axnotify:userName>axnotify:userName</axnotify:userName>
													</axnotify:HUBAdminAppApprovalEmailNotificationRequest>
												</bpel:literal>
											</bpel:from>
											<bpel:to variable="input_op_approver_dialog_email_notification"
												part="HUBAdminAppApprovalEmailNotificationRequest"></bpel:to>
										</bpel:copy>
										<bpel:copy>
											<bpel:from>
										<![CDATA['dialog-admin-role']]>
											</bpel:from>
											<bpel:to part="HUBAdminAppApprovalEmailNotificationRequest"
												variable="input_op_approver_dialog_email_notification">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:receiverRole]]></bpel:query>
											</bpel:to>
										</bpel:copy>
										<bpel:copy>
											<bpel:from part="payload" variable="clientRequest">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationName]]></bpel:query>
											</bpel:from>
											<bpel:to part="HUBAdminAppApprovalEmailNotificationRequest"
												variable="input_op_approver_dialog_email_notification">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:applicationName]]></bpel:query>
											</bpel:to>
										</bpel:copy>
										<bpel:copy>
											<bpel:from part="ApplicationApprovalResponse"
												variable="output_ht">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:selectedTier]]></bpel:query>
											</bpel:from>
											<bpel:to part="HUBAdminAppApprovalEmailNotificationRequest"
												variable="input_op_approver_dialog_email_notification">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:applicationTier]]></bpel:query>
											</bpel:to>
										</bpel:copy>
										<bpel:copy>
											<bpel:from part="payload" variable="clientRequest">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationDescription]]></bpel:query>
											</bpel:from>
											<bpel:to part="HUBAdminAppApprovalEmailNotificationRequest"
												variable="input_op_approver_dialog_email_notification">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:applicationDescription]]></bpel:query>
											</bpel:to>
										</bpel:copy>
										<bpel:copy>
											<bpel:from part="payload" variable="clientRequest">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:userName]]></bpel:query>
											</bpel:from>
											<bpel:to part="HUBAdminAppApprovalEmailNotificationRequest"
												variable="input_op_approver_dialog_email_notification">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:userName]]></bpel:query>
											</bpel:to>
										</bpel:copy>
									</bpel:assign>
									<bpel:invoke name="invoke_op_approver_dialog_email_notification"
										partnerLink="AXNOTIFYPL" operation="sendHUBAdminAppApprovalEmailNotification"
										portType="axnotify:AxiataWorkflowNotificationServicePT"
										inputVariable="input_op_approver_dialog_email_notification">
									</bpel:invoke>
								</bpel:sequence>
							</bpel:if>

							<!-- Initialize the operator approval humantask request and set input 
								parameters. -->
							<bpel:assign validate="no" name="assign_op_input">
								<bpel:copy>
									<bpel:from>
										<bpel:literal xml:space="preserve">
                                        		<tschema:ApplicationApprovalData
											xmlns:tschema="http://workflow.application.apimgt.carbon.wso2.org"
											xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                                        			<tschema:applicationName>tschema:applicationName</tschema:applicationName>
  													<tschema:applicationId></tschema:applicationId>
  													<tschema:applicationTier>tschema:applicationTier</tschema:applicationTier>
  													<tschema:applicationCallbackUrl>tschema:applicationCallbackUrl</tschema:applicationCallbackUrl>
  													<tschema:applicationDescription>tschema:applicationDescription</tschema:applicationDescription>
  													<tschema:tenantDomain>tschema:tenantDomain</tschema:tenantDomain>
  													<tschema:userName>tschema:userName</tschema:userName>
  													<tschema:workflowExternalRef>tschema:workflowExternalRef</tschema:workflowExternalRef>
  													<tschema:callBackURL>tschema:callBackURL</tschema:callBackURL>
  													<tschema:operatorID>tschema:operatorID</tschema:operatorID>
  													<tschema:authorizedRole>tschema:authorizedRole</tschema:authorizedRole> 
                                                </tschema:ApplicationApprovalData>
											</bpel:literal>
									</bpel:from>
									<bpel:to variable="input_op_ht_dialog" part="ApplicationApprovalRequest"></bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from part="payload" variable="clientRequest">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationName]]></bpel:query>
									</bpel:from>
									<bpel:to part="ApplicationApprovalRequest" variable="input_op_ht_dialog">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationName]]></bpel:query>
									</bpel:to>
								</bpel:copy>
								<bpel:copy>
									<!-- <bpel:from part="payload" variable="clientRequest"> <bpel:query 
										queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationTier]]></bpel:query> 
										</bpel:from> -->
									<bpel:from part="ApplicationApprovalResponse"
										variable="output_ht">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:selectedTier]]></bpel:query>
									</bpel:from>
									<bpel:to part="ApplicationApprovalRequest" variable="input_op_ht_dialog">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationTier]]></bpel:query>
									</bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from part="payload" variable="clientRequest">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationCallbackUrl]]></bpel:query>
									</bpel:from>
									<bpel:to part="ApplicationApprovalRequest" variable="input_op_ht_dialog">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationCallbackUrl]]></bpel:query>
									</bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from part="payload" variable="clientRequest">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationDescription]]></bpel:query>
									</bpel:from>
									<bpel:to part="ApplicationApprovalRequest" variable="input_op_ht_dialog">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationDescription]]></bpel:query>
									</bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from part="payload" variable="clientRequest">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:tenantDomain]]></bpel:query>
									</bpel:from>
									<bpel:to part="ApplicationApprovalRequest" variable="input_op_ht_dialog">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:tenantDomain]]></bpel:query>
									</bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from part="payload" variable="clientRequest">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:userName]]></bpel:query>
									</bpel:from>
									<bpel:to part="ApplicationApprovalRequest" variable="input_op_ht_dialog">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:userName]]></bpel:query>
									</bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from part="payload" variable="clientRequest">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:workflowExternalRef]]></bpel:query>
									</bpel:from>
									<bpel:to part="ApplicationApprovalRequest" variable="input_op_ht_dialog">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:workflowExternalRef]]></bpel:query>
									</bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from part="payload" variable="clientRequest">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:callBackURL]]></bpel:query>
									</bpel:from>
									<bpel:to part="ApplicationApprovalRequest" variable="input_op_ht_dialog">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:callBackURL]]></bpel:query>
									</bpel:to>
								</bpel:copy>

								<!-- Set Dialog operator ID. -->
								<bpel:copy>
									<bpel:from>
                                            <![CDATA['1']]>
									</bpel:from>
									<bpel:to part="ApplicationApprovalRequest" variable="input_op_ht_dialog">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                                <![CDATA[tns:operatorID]]>
										</bpel:query>
									</bpel:to>
								</bpel:copy>

								<!-- Set Dialog operator role. Operator role is of the syntax: lower-case(<<operator 
									name>>) + '-admin-role' -->
								<bpel:copy>
									<bpel:from>
                                            <![CDATA['dialog-admin-role']]>
									</bpel:from>
									<bpel:to part="ApplicationApprovalRequest" variable="input_op_ht_dialog">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                                <![CDATA[tns:authorizedRole]]>
										</bpel:query>
									</bpel:to>
								</bpel:copy>
							</bpel:assign>

							<!-- Trigger operator approval humantask for Dialog operator. -->
							<bpel:extensionActivity>
								<b4p:peopleActivity name="approve_application_operator"
									inputVariable="input_op_ht_dialog" outputVariable="output_op_ht_dialog">
									<b4p:remoteTask partnerLink="AAPL" operation="approve"
										responseOperation="approvalResponse"></b4p:remoteTask>
								</b4p:peopleActivity>
							</bpel:extensionActivity>

							<!-- If operator level admin approved the request. -->
							<!-- <bpel:if name="if_op_admin_approved"> <bpel:condition> <![CDATA[contains($output_op_ht_dialog.ApplicationApprovalResponse, 
								"APPROVED")]]> </bpel:condition> -->

							<!-- Initialize the operator approval database update request and 
								set input parameter values. -->
							<bpel:sequence>
								<bpel:assign validate="no" name="assign_op_db_input">
									<bpel:copy>
										<bpel:from>
											<bpel:literal>
												<ax:AppOpApprovalDBUpdateRequest
													xmlns:ax="http://org.wso2.carbon/axiata/workflow/application"
													xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
													<ax:requestType>ax:requestType</ax:requestType>
													<ax:appID>ax:appID</ax:appID>
													<ax:opID>ax:opID</ax:opID>
													<ax:status>ax:status</ax:status>
												</ax:AppOpApprovalDBUpdateRequest>
											</bpel:literal>
										</bpel:from>
										<bpel:to variable="input_op_approval_db_dialog" part="AppOpApprovalDBUpdateRequest"></bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from>
                                			<![CDATA['OP_APPROVAL']]>
										</bpel:from>
										<bpel:to part="AppOpApprovalDBUpdateRequest" variable="input_op_approval_db_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:requestType]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationId]]></bpel:query>
										</bpel:from>
										<bpel:to part="AppOpApprovalDBUpdateRequest" variable="input_op_approval_db_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:appID]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from>
                                            <![CDATA['1']]>
										</bpel:from>
										<bpel:to part="AppOpApprovalDBUpdateRequest" variable="input_op_approval_db_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:opID]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="ApplicationApprovalResponse"
											variable="output_op_ht_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:status]]></bpel:query>
										</bpel:from>
										<bpel:to part="AppOpApprovalDBUpdateRequest" variable="input_op_approval_db_dialog">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:status]]></bpel:query>
										</bpel:to>
									</bpel:copy>
								</bpel:assign>

								<!-- Invoke the service to perform operator approval database updates. -->
								<bpel:invoke name="invoke_op_approval_db_update"
									partnerLink="AAOPPL" operation="updateDBAppOpApproval"
									portType="ns2:AxiataWorkflowApprovalServicePT" inputVariable="input_op_approval_db_dialog">
								</bpel:invoke>
							</bpel:sequence>
							<!-- </bpel:if> -->

							<!-- Publish audit data related to Dialog OpCo approval. -->
							<bpel:assign validate="no" name="assign_op_au_intput_dialog">
								<bpel:copy>
									<bpel:from>
										<bpel:literal>
											<axau:AppApprovalAuditRequest
												xmlns:axau="http://org.wso2.carbon/axiata/workflow/audit"
												xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
												<axau:requestType>axau:requestType</axau:requestType>
												<axau:appName>axau:appName</axau:appName>
												<axau:appCreator>axau:appCreator</axau:appCreator>
												<axau:appStatus>axau:appStatus</axau:appStatus>
												<axau:appApprovalType>axau:appApprovalType
												</axau:appApprovalType>
												<axau:completedByRole>axau:completedByRole
												</axau:completedByRole>
												<axau:completedByUser>axau:completedByUser
												</axau:completedByUser>
												<axau:completedOn>axau:completedOn</axau:completedOn>
											</axau:AppApprovalAuditRequest>
										</bpel:literal>
									</bpel:from>
									<bpel:to variable="input_op_app_approval_audit_dialog"
										part="AppApprovalAuditRequest"></bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from>
										<![CDATA['APP_APPROVAL_AUDIT_REQUEST']]>
									</bpel:from>
									<bpel:to part="AppApprovalAuditRequest" variable="input_op_app_approval_audit_dialog">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:requestType]]></bpel:query>
									</bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from part="payload" variable="clientRequest">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationName]]></bpel:query>
									</bpel:from>
									<bpel:to part="AppApprovalAuditRequest" variable="input_op_app_approval_audit_dialog">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:appName]]></bpel:query>
									</bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from part="payload" variable="clientRequest">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:userName]]></bpel:query>
									</bpel:from>
									<bpel:to part="AppApprovalAuditRequest" variable="input_op_app_approval_audit_dialog">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:appCreator]]></bpel:query>
									</bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from part="ApplicationApprovalResponse"
										variable="output_op_ht_dialog">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:status]]></bpel:query>
									</bpel:from>
									<bpel:to part="AppApprovalAuditRequest" variable="input_op_app_approval_audit_dialog">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:appStatus]]></bpel:query>
									</bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from>
										<![CDATA['HUB-OPCO-DIALOG']]>
									</bpel:from>
									<bpel:to part="AppApprovalAuditRequest" variable="input_op_app_approval_audit_dialog">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:appApprovalType]]></bpel:query>
									</bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from>
										<![CDATA['dialog-admin-role']]>
									</bpel:from>
									<bpel:to part="AppApprovalAuditRequest" variable="input_op_app_approval_audit_dialog">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:completedByRole]]></bpel:query>
									</bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from part="ApplicationApprovalResponse"
										variable="output_op_ht_dialog">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:completedByUser]]></bpel:query>
									</bpel:from>
									<bpel:to part="AppApprovalAuditRequest" variable="input_op_app_approval_audit_dialog">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:completedByUser]]></bpel:query>
									</bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from part="ApplicationApprovalResponse"
										variable="output_op_ht_dialog">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:completedOn]]></bpel:query>
									</bpel:from>
									<bpel:to part="AppApprovalAuditRequest" variable="input_op_app_approval_audit_dialog">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:completedOn]]></bpel:query>
									</bpel:to>
								</bpel:copy>
							</bpel:assign>
							<bpel:invoke name="invoke_op_app_approval_audit_insert_dialog"
								partnerLink="AAUPL" operation="insertAppApprovalAuditRecord"
								portType="ns2:AxiataWorkflowApprovalServicePT" inputVariable="input_op_app_approval_audit_dialog">
							</bpel:invoke>

						</bpel:sequence>

						<!-- Operator approval sequence: Celcom -->
						<bpel:sequence name="celcom_op_approval_sequence">

							<bpel:if name="if_email_notifications_enabled">
								<bpel:condition>
                				<![CDATA[false()]]>
								</bpel:condition>
								<bpel:sequence>
									<bpel:assign validate="no"
										name="assign_op_approver_celcom_email_notification">
										<bpel:copy>
											<bpel:from>
												<bpel:literal>
													<axnotify:HUBAdminAppApprovalEmailNotificationRequest
														xmlns:axnotify="http://org.wso2.carbon/axiata/workflow/notify"
														xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
														<axnotify:receiverRole>axnotify:receiverRole
														</axnotify:receiverRole>
														<axnotify:applicationName>axnotify:applicationName
														</axnotify:applicationName>
														<axnotify:applicationTier>axnotify:applicationTier
														</axnotify:applicationTier>
														<axnotify:applicationDescription>axnotify:applicationDescription
														</axnotify:applicationDescription>
														<axnotify:userName>axnotify:userName</axnotify:userName>
													</axnotify:HUBAdminAppApprovalEmailNotificationRequest>
												</bpel:literal>
											</bpel:from>
											<bpel:to variable="input_op_approver_celcom_email_notification"
												part="HUBAdminAppApprovalEmailNotificationRequest"></bpel:to>
										</bpel:copy>
										<bpel:copy>
											<bpel:from>
										<![CDATA['celcom-admin-role']]>
											</bpel:from>
											<bpel:to part="HUBAdminAppApprovalEmailNotificationRequest"
												variable="input_op_approver_celcom_email_notification">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:receiverRole]]></bpel:query>
											</bpel:to>
										</bpel:copy>
										<bpel:copy>
											<bpel:from part="payload" variable="clientRequest">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationName]]></bpel:query>
											</bpel:from>
											<bpel:to part="HUBAdminAppApprovalEmailNotificationRequest"
												variable="input_op_approver_celcom_email_notification">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:applicationName]]></bpel:query>
											</bpel:to>
										</bpel:copy>
										<bpel:copy>
											<bpel:from part="ApplicationApprovalResponse"
												variable="output_ht">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:selectedTier]]></bpel:query>
											</bpel:from>
											<bpel:to part="HUBAdminAppApprovalEmailNotificationRequest"
												variable="input_op_approver_celcom_email_notification">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:applicationTier]]></bpel:query>
											</bpel:to>
										</bpel:copy>
										<bpel:copy>
											<bpel:from part="payload" variable="clientRequest">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationDescription]]></bpel:query>
											</bpel:from>
											<bpel:to part="HUBAdminAppApprovalEmailNotificationRequest"
												variable="input_op_approver_celcom_email_notification">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:applicationDescription]]></bpel:query>
											</bpel:to>
										</bpel:copy>
										<bpel:copy>
											<bpel:from part="payload" variable="clientRequest">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:userName]]></bpel:query>
											</bpel:from>
											<bpel:to part="HUBAdminAppApprovalEmailNotificationRequest"
												variable="input_op_approver_celcom_email_notification">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axnotify:userName]]></bpel:query>
											</bpel:to>
										</bpel:copy>
									</bpel:assign>
									<bpel:invoke name="invoke_op_approver_celcom_email_notification"
										partnerLink="AXNOTIFYPL" operation="sendHUBAdminAppApprovalEmailNotification"
										portType="axnotify:AxiataWorkflowNotificationServicePT"
										inputVariable="input_op_approver_celcom_email_notification">
									</bpel:invoke>
								</bpel:sequence>
							</bpel:if>

							<!-- Initialize the operator approval humantask request and set input 
								parameters. -->
							<bpel:assign validate="no" name="assign_op_input">
								<bpel:copy>
									<bpel:from>
										<bpel:literal xml:space="preserve">
                                        		<tschema:ApplicationApprovalData
											xmlns:tschema="http://workflow.application.apimgt.carbon.wso2.org"
											xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                                        			<tschema:applicationName>tschema:applicationName</tschema:applicationName>
  													<tschema:applicationId></tschema:applicationId>
  													<tschema:applicationTier>tschema:applicationTier</tschema:applicationTier>
  													<tschema:applicationCallbackUrl>tschema:applicationCallbackUrl</tschema:applicationCallbackUrl>
  													<tschema:applicationDescription>tschema:applicationDescription</tschema:applicationDescription>
  													<tschema:tenantDomain>tschema:tenantDomain</tschema:tenantDomain>
  													<tschema:userName>tschema:userName</tschema:userName>
  													<tschema:workflowExternalRef>tschema:workflowExternalRef</tschema:workflowExternalRef>
  													<tschema:callBackURL>tschema:callBackURL</tschema:callBackURL>
  													<tschema:operatorID>tschema:operatorID</tschema:operatorID>
  													<tschema:authorizedRole>tschema:authorizedRole</tschema:authorizedRole> 
                                                </tschema:ApplicationApprovalData>
											</bpel:literal>
									</bpel:from>
									<bpel:to variable="input_op_ht_celcom" part="ApplicationApprovalRequest"></bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from part="payload" variable="clientRequest">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationName]]></bpel:query>
									</bpel:from>
									<bpel:to part="ApplicationApprovalRequest" variable="input_op_ht_celcom">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationName]]></bpel:query>
									</bpel:to>
								</bpel:copy>
								<bpel:copy>
									<!-- <bpel:from part="payload" variable="clientRequest"> <bpel:query 
										queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationTier]]></bpel:query> 
										</bpel:from> -->
									<bpel:from part="ApplicationApprovalResponse"
										variable="output_ht">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:selectedTier]]></bpel:query>
									</bpel:from>
									<bpel:to part="ApplicationApprovalRequest" variable="input_op_ht_celcom">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationTier]]></bpel:query>
									</bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from part="payload" variable="clientRequest">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationCallbackUrl]]></bpel:query>
									</bpel:from>
									<bpel:to part="ApplicationApprovalRequest" variable="input_op_ht_celcom">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationCallbackUrl]]></bpel:query>
									</bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from part="payload" variable="clientRequest">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationDescription]]></bpel:query>
									</bpel:from>
									<bpel:to part="ApplicationApprovalRequest" variable="input_op_ht_celcom">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationDescription]]></bpel:query>
									</bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from part="payload" variable="clientRequest">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:tenantDomain]]></bpel:query>
									</bpel:from>
									<bpel:to part="ApplicationApprovalRequest" variable="input_op_ht_celcom">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:tenantDomain]]></bpel:query>
									</bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from part="payload" variable="clientRequest">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:userName]]></bpel:query>
									</bpel:from>
									<bpel:to part="ApplicationApprovalRequest" variable="input_op_ht_celcom">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:userName]]></bpel:query>
									</bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from part="payload" variable="clientRequest">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:workflowExternalRef]]></bpel:query>
									</bpel:from>
									<bpel:to part="ApplicationApprovalRequest" variable="input_op_ht_celcom">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:workflowExternalRef]]></bpel:query>
									</bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from part="payload" variable="clientRequest">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:callBackURL]]></bpel:query>
									</bpel:from>
									<bpel:to part="ApplicationApprovalRequest" variable="input_op_ht_celcom">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:callBackURL]]></bpel:query>
									</bpel:to>
								</bpel:copy>

								<!-- Set Celcom operator ID. -->
								<bpel:copy>
									<bpel:from>
                                            <![CDATA['2']]>
									</bpel:from>
									<bpel:to part="ApplicationApprovalRequest" variable="input_op_ht_celcom">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                                <![CDATA[tns:operatorID]]>
										</bpel:query>
									</bpel:to>
								</bpel:copy>

								<!-- Set Celcom operator role. Operator role is of the syntax: lower-case(<<operator 
									name>>) + '-admin-role' -->
								<bpel:copy>
									<bpel:from>
                                            <![CDATA['celcom-admin-role']]>
									</bpel:from>
									<bpel:to part="ApplicationApprovalRequest" variable="input_op_ht_celcom">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                                <![CDATA[tns:authorizedRole]]>
										</bpel:query>
									</bpel:to>
								</bpel:copy>
							</bpel:assign>

							<!-- Trigger operator approval humantask for Celcom operator. -->
							<bpel:extensionActivity>
								<b4p:peopleActivity name="approve_application_operator"
									inputVariable="input_op_ht_celcom" outputVariable="output_op_ht_celcom">
									<b4p:remoteTask partnerLink="AAPL" operation="approve"
										responseOperation="approvalResponse"></b4p:remoteTask>
								</b4p:peopleActivity>
							</bpel:extensionActivity>

							<!-- If operator level admin approved the request. -->
							<!-- <bpel:if name="if_op_admin_approved"> <bpel:condition> <![CDATA[contains($output_op_ht_celcom.ApplicationApprovalResponse, 
								"APPROVED")]]> </bpel:condition> -->

							<!-- Initialize the operator approval database update request and 
								set input parameter values. -->
							<bpel:sequence>
								<bpel:assign validate="no" name="assign_op_db_input">
									<bpel:copy>
										<bpel:from>
											<bpel:literal>
												<ax:AppOpApprovalDBUpdateRequest
													xmlns:ax="http://org.wso2.carbon/axiata/workflow/application"
													xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
													<ax:requestType>ax:requestType</ax:requestType>
													<ax:appID>ax:appID</ax:appID>
													<ax:opID>ax:opID</ax:opID>
													<ax:status>ax:status</ax:status>
												</ax:AppOpApprovalDBUpdateRequest>
											</bpel:literal>
										</bpel:from>
										<bpel:to variable="input_op_approval_db_celcom" part="AppOpApprovalDBUpdateRequest"></bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from>
                                			<![CDATA['OP_APPROVAL']]>
										</bpel:from>
										<bpel:to part="AppOpApprovalDBUpdateRequest" variable="input_op_approval_db_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:requestType]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="payload" variable="clientRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationId]]></bpel:query>
										</bpel:from>
										<bpel:to part="AppOpApprovalDBUpdateRequest" variable="input_op_approval_db_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:appID]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from>
                                            <![CDATA['2']]>
										</bpel:from>
										<bpel:to part="AppOpApprovalDBUpdateRequest" variable="input_op_approval_db_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:opID]]></bpel:query>
										</bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="ApplicationApprovalResponse"
											variable="output_op_ht_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:status]]></bpel:query>
										</bpel:from>
										<bpel:to part="AppOpApprovalDBUpdateRequest" variable="input_op_approval_db_celcom">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:status]]></bpel:query>
										</bpel:to>
									</bpel:copy>
								</bpel:assign>

								<!-- Invoke the service to perform operator approval database updates. -->
								<bpel:invoke name="invoke_op_approval_db_update"
									partnerLink="AAOPPL" operation="updateDBAppOpApproval"
									portType="ns2:AxiataWorkflowApprovalServicePT" inputVariable="input_op_approval_db_celcom">
								</bpel:invoke>
							</bpel:sequence>
							<!-- Publish audit data related to Celcom OpCo approval. -->
							<bpel:assign validate="no" name="assign_op_au_intput_celcom">
								<bpel:copy>
									<bpel:from>
										<bpel:literal>
											<axau:AppApprovalAuditRequest
												xmlns:axau="http://org.wso2.carbon/axiata/workflow/audit"
												xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
												<axau:requestType>axau:requestType</axau:requestType>
												<axau:appName>axau:appName</axau:appName>
												<axau:appCreator>axau:appCreator</axau:appCreator>
												<axau:appStatus>axau:appStatus</axau:appStatus>
												<axau:appApprovalType>axau:appApprovalType
												</axau:appApprovalType>
												<axau:completedByRole>axau:completedByRole
												</axau:completedByRole>
												<axau:completedByUser>axau:completedByUser
												</axau:completedByUser>
												<axau:completedOn>axau:completedOn</axau:completedOn>
											</axau:AppApprovalAuditRequest>
										</bpel:literal>
									</bpel:from>
									<bpel:to variable="input_op_app_approval_audit_celcom"
										part="AppApprovalAuditRequest"></bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from>
										<![CDATA['APP_APPROVAL_AUDIT_REQUEST']]>
									</bpel:from>
									<bpel:to part="AppApprovalAuditRequest" variable="input_op_app_approval_audit_celcom">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:requestType]]></bpel:query>
									</bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from part="payload" variable="clientRequest">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:applicationName]]></bpel:query>
									</bpel:from>
									<bpel:to part="AppApprovalAuditRequest" variable="input_op_app_approval_audit_celcom">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:appName]]></bpel:query>
									</bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from part="payload" variable="clientRequest">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:userName]]></bpel:query>
									</bpel:from>
									<bpel:to part="AppApprovalAuditRequest" variable="input_op_app_approval_audit_celcom">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:appCreator]]></bpel:query>
									</bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from part="ApplicationApprovalResponse"
										variable="output_op_ht_celcom">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:status]]></bpel:query>
									</bpel:from>
									<bpel:to part="AppApprovalAuditRequest" variable="input_op_app_approval_audit_celcom">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:appStatus]]></bpel:query>
									</bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from>
										<![CDATA['HUB-OPCO-DIALOG']]>
									</bpel:from>
									<bpel:to part="AppApprovalAuditRequest" variable="input_op_app_approval_audit_celcom">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:appApprovalType]]></bpel:query>
									</bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from>
										<![CDATA['celcom-admin-role']]>
									</bpel:from>
									<bpel:to part="AppApprovalAuditRequest" variable="input_op_app_approval_audit_dialog">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:completedByRole]]></bpel:query>
									</bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from part="ApplicationApprovalResponse"
										variable="output_op_ht_celcom">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:completedByUser]]></bpel:query>
									</bpel:from>
									<bpel:to part="AppApprovalAuditRequest" variable="input_op_app_approval_audit_celcom">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:completedByUser]]></bpel:query>
									</bpel:to>
								</bpel:copy>
								<bpel:copy>
									<bpel:from part="ApplicationApprovalResponse"
										variable="output_op_ht_celcom">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:completedOn]]></bpel:query>
									</bpel:from>
									<bpel:to part="AppApprovalAuditRequest" variable="input_op_app_approval_audit_celcom">
										<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[axau:completedOn]]></bpel:query>
									</bpel:to>
								</bpel:copy>
							</bpel:assign>
							<bpel:invoke name="invoke_op_app_approval_audit_insert_celcom"
								partnerLink="AAUPL" operation="insertAppApprovalAuditRecord"
								portType="ns2:AxiataWorkflowApprovalServicePT" inputVariable="input_op_app_approval_audit_celcom">
							</bpel:invoke>
							<!-- </bpel:if> -->
						</bpel:sequence>
					</bpel:flow>
				</bpel:sequence>
			</bpel:if>
		</bpel:sequence>
	</bpel:sequence>
</bpel:process>

